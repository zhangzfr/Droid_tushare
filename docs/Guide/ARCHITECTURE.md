# ğŸ—ï¸ Droid-Tushare ç³»ç»Ÿæ¶æ„æ·±åº¦è§£æ

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Droid-Tushare é¡¹ç›®çš„ç³»ç»Ÿæ¶æ„è®¾è®¡ã€æ¨¡å—èŒè´£ã€æ•°æ®æµè½¬ä»¥åŠæŠ€æœ¯é€‰å‹ï¼Œé¢å‘å¼€å‘è€…ã€ç³»ç»Ÿæ¶æ„å¸ˆå’Œé«˜çº§ç”¨æˆ·ã€‚

---

## ğŸ“‹ ç›®å½•

- [1. ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
- [2. æ•´ä½“æ¶æ„å›¾](#2-æ•´ä½“æ¶æ„å›¾)
- [3. æ ¸å¿ƒæ¨¡å—è¯¦è§£](#3-æ ¸å¿ƒæ¨¡å—è¯¦è§£)
- [4. æ•°æ®æµè½¬å…¨æ™¯](#4-æ•°æ®æµè½¬å…¨æ™¯)
- [5. æŠ€æœ¯æ ˆè¯´æ˜](#5-æŠ€æœ¯æ ˆè¯´æ˜)
- [6. è®¾è®¡åŸåˆ™ä¸æ¨¡å¼](#6-è®¾è®¡åŸåˆ™ä¸æ¨¡å¼)
- [7. æ€§èƒ½ä¸æ‰©å±•æ€§](#7-æ€§èƒ½ä¸æ‰©å±•æ€§)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½

Droid-Tushare æ˜¯ä¸€ä¸ª**å·¥ä¸šçº§çš„é‡‘èæ•°æ®æœ¬åœ°åŒ–åŒæ­¥ä¸é‡åŒ–åˆ†æå¹³å°**ï¼Œä¸»è¦è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š

- **æ•°æ®è·å–ç—›ç‚¹**ï¼šTushare API çš„é¢‘ç‡é™åˆ¶ã€ç½‘ç»œå»¶è¿Ÿã€æ•°æ®è´¨é‡ä¸ç¨³å®š
- **æ•°æ®ç®¡ç†ç—›ç‚¹**ï¼šç¼ºä¹æœ¬åœ°åŒ–æ•°æ®ä»“åº“ã€æ•°æ®æ›´æ–°å›°éš¾ã€å†å²æ•°æ®è¿½æº¯å›°éš¾
- **é‡åŒ–åˆ†æç—›ç‚¹**ï¼šæ•°æ®æ ¼å¼ä¸ç»Ÿä¸€ã€è®¡ç®—æ•ˆç‡ä½ã€ç¼ºä¹å¯è§†åŒ–å·¥å…·

### 1.2 æ ¸å¿ƒèƒ½åŠ›çŸ©é˜µ

| èƒ½åŠ›ç»´åº¦ | æ ¸å¿ƒåŠŸèƒ½ | æŠ€æœ¯å®ç° |
|---------|---------|---------|
| **æ•°æ®åŒæ­¥** | 50+ è¡¨è‡ªåŠ¨åŒæ­¥ã€æ™ºèƒ½å¢é‡æ›´æ–°ã€åˆ†é¡µå¤„ç† | Tushare API + åˆ†é¡µç®—æ³• + é‡è¯•æœºåˆ¶ |
| **æ•°æ®å­˜å‚¨** | é«˜æ€§èƒ½æŸ¥è¯¢ã€åˆ—å¼å­˜å‚¨ã€åŸå­æ“ä½œ | DuckDB + å¤šæ•°æ®åº“æ¶æ„ |
| **æ•°æ®è´¨é‡** | è‡ªåŠ¨æ ¡éªŒã€å¼‚å¸¸æ£€æµ‹ã€è¦†ç›–ç‡åˆ†æ | ç»Ÿè®¡å­¦ç®—æ³• + å…ƒæ•°æ®è¿½è¸ª |
| **é‡åŒ–åˆ†æ** | VIX è®¡ç®—ã€å›æµ‹æ¡†æ¶ã€ç­–ç•¥åˆ†æ | CBOE æ–¹æ³•è®º + Backtrader |
| **æ•°æ®å¯è§†åŒ–** | äº¤äº’å¼ä»ªè¡¨ç›˜ã€çƒ­åŠ›å›¾ã€è¶‹åŠ¿åˆ†æ | Streamlit + Plotly |
| **è¿ç»´ç›‘æ§** | æ—¥å¿—è¿½è¸ªã€æ€§èƒ½ç›‘æ§ã€æ•…éšœæ¢å¤ | æ—¥å¿—ç³»ç»Ÿ + å…ƒæ•°æ®ç®¡ç† |

### 1.3 ç³»ç»Ÿè§„æ¨¡

- **ä»£ç é‡**ï¼šçº¦ 10,000 è¡Œ Python ä»£ç 
- **æ•°æ®è¡¨**ï¼š50+ å¼ é‡‘èæ•°æ®è¡¨
- **æ•°æ®ç±»åˆ«**ï¼š14 ä¸ªä¸»è¦ç±»åˆ«ï¼ˆè‚¡ç¥¨ã€æŒ‡æ•°ã€åŸºé‡‘ã€æœŸæƒã€æœŸè´§ã€å€ºåˆ¸ã€å®è§‚ç­‰ï¼‰
- **æ•°æ®åº“æ–‡ä»¶**ï¼š14 ä¸ªç‹¬ç«‹çš„ DuckDB æ•°æ®åº“æ–‡ä»¶
- **æ”¯æŒçš„æ ‡çš„**ï¼š9 ä¸ª ETF æœŸæƒ + 3 ä¸ªæŒ‡æ•°æœŸæƒ

---

## 2. æ•´ä½“æ¶æ„å›¾

### 2.1 ç³»ç»Ÿåˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç”¨æˆ·äº¤äº’å±‚ (User Interface)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  CLI Terminalâ”‚  â”‚  Dashboard   â”‚  â”‚  Python API  â”‚  â”‚   Notebooks  â”‚ â”‚
â”‚  â”‚  (main.py)   â”‚  â”‚  (app.py)    â”‚  â”‚  (processor) â”‚  â”‚  (VIX.ipynb) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ•°æ®åŒæ­¥å¼•æ“                 â”‚  â”‚  é‡åŒ–åˆ†æå¼•æ“                     â”‚  â”‚
â”‚  â”‚  (tushare_duckdb)            â”‚  â”‚  (vix)                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ TushareFetcher           â”‚  â”‚  â”œâ”€ DataLoader                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ DataProcessor            â”‚  â”‚  â”œâ”€ Calculator                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ DuckDBStorage            â”‚  â”‚  â””â”€ Backtester                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ DataValidator            â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚  â””â”€ MetadataManager          â”‚  â”‚                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å¯è§†åŒ–å¼•æ“                  â”‚  â”‚  å·¥å…·é›†                           â”‚  â”‚
â”‚  â”‚  (dashboard)                 â”‚  â”‚  (utils/VIX)                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ DataLoaders              â”‚  â”‚  â”œâ”€ æ•°æ®å¤„ç†å·¥å…·                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Charts                   â”‚  â”‚  â”œâ”€ å¯è§†åŒ–å·¥å…·                     â”‚  â”‚
â”‚  â”‚  â””â”€ Navigation               â”‚  â”‚  â””â”€ å›æµ‹å·¥å…·                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ•°æ®è®¿é—®å±‚ (Data Access)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  DuckDB è¿æ¥ç®¡ç†              â”‚  â”‚  å¤–éƒ¨ API ç®¡ç†                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ è¿æ¥æ±                    â”‚  â”‚  â”œâ”€ Tushare Pro API              â”‚  â”‚
â”‚  â”‚  â”œâ”€ äº‹åŠ¡ç®¡ç†                 â”‚  â”‚  â”œâ”€ é™æµæ§åˆ¶                      â”‚  â”‚
â”‚  â”‚  â””â”€ é”™è¯¯å¤„ç†                 â”‚  â”‚  â””â”€ é‡è¯•æœºåˆ¶                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ•°æ®å­˜å‚¨å±‚ (Data Storage)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Stock DB  â”‚ â”‚  Index DB  â”‚ â”‚  Fund DB   â”‚ â”‚  Option DB â”‚              â”‚
â”‚  â”‚  tushare_  â”‚ â”‚  tushare_  â”‚ â”‚  tushare_  â”‚ â”‚  tushare_  â”‚              â”‚
â”‚  â”‚  duck_stockâ”‚ â”‚  duck_indexâ”‚ â”‚  duck_fund â”‚ â”‚  duck_opt  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Future DB  â”‚ â”‚  Bond DB   â”‚ â”‚ Macro DB   â”‚ â”‚  Margin DB â”‚              â”‚
â”‚  â”‚ tushare_   â”‚ â”‚ tushare_   â”‚ â”‚ tushare_   â”‚ â”‚ tushare_   â”‚              â”‚
â”‚  â”‚ duck_futureâ”‚ â”‚ duck_bond  â”‚ â”‚ duck_macro  â”‚ â”‚ duck_marginâ”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Basic DB  â”‚ â”‚  Weight DB â”‚ â”‚ Moneyflow  â”‚ â”‚ Finance DB â”‚              â”‚
â”‚  â”‚ tushare_   â”‚ â”‚ tushare_   â”‚ â”‚ tushare_   â”‚ â”‚ tushare_   â”‚              â”‚
â”‚  â”‚ duck_basic â”‚ â”‚ duck_weightâ”‚ â”‚ duck_moneyflowâ”‚duck_financeâ”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµè½¬å…¨æ™¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tushare API  â”‚
â”‚  (Data Source)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. API è¯·æ±‚
       â”‚    - åˆ†é¡µå¤„ç†
       â”‚    - é™æµæ§åˆ¶
       â”‚    - è‡ªåŠ¨é‡è¯•
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚TushareFetcherâ”‚
â”‚ (fetcher.py) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. åŸå§‹æ•°æ®
       â”‚    - DataFrame
       â”‚    - å»é‡
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚DataProcessor â”‚
â”‚ (processor.py)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. å¤„ç†åæ•°æ®
       â”‚    - å­—æ®µæ˜ å°„
       â”‚    - æ—¥æœŸæ ‡å‡†åŒ–
       â”‚    - NULL è¿‡æ»¤
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚DuckDBStorage â”‚
â”‚ (storage.py) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. å†™å…¥æ•°æ®åº“
       â”‚    - å¢é‡/è¦†ç›–
       â”‚    - åŸå­æ“ä½œ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DuckDB DB  â”‚
â”‚  (14ä¸ªæ–‡ä»¶)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚            â”‚
       â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚DataValidator â”‚ â”‚ Metadata     â”‚
â”‚ (data_       â”‚ â”‚ (metadata.py)â”‚
â”‚ validation.py)â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
       â”‚              â”‚ 5. æ›´æ–°å…ƒæ•°æ®
       â”‚              â”‚    - min/max æ—¥æœŸ
       â”‚              â”‚    - è®°å½•æ•°
       â”‚              â”‚    - æœ€åæ›´æ–°æ—¶é—´
       â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard   â”‚ â”‚  VIX Module  â”‚
â”‚  (app.py)    â”‚ â”‚  (vix/run.py)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ¨¡å—ä¾èµ–å…³ç³»

```mermaid
graph TD
    A[ç”¨æˆ·ç•Œé¢å±‚] --> B[CLI Terminal]
    A --> C[Dashboard]
    A --> D[Python API]

    B --> E[æ•°æ®åŒæ­¥å¼•æ“]
    C --> F[å¯è§†åŒ–å¼•æ“]
    D --> E
    D --> G[é‡åŒ–åˆ†æå¼•æ“]

    E --> H[TushareFetcher]
    E --> I[DataProcessor]
    E --> J[DuckDBStorage]
    E --> K[DataValidator]

    G --> L[DataLoader]
    G --> M[Calculator]
    G --> N[Backtester]

    F --> O[DataLoaders]
    F --> P[Charts]

    H --> Q[DuckDB Connections]
    I --> Q
    J --> Q
    K --> Q
    L --> Q
    O --> Q

    Q --> R[14ä¸ªæ•°æ®åº“æ–‡ä»¶]
    R --> S[æ•°æ®å…ƒæ•°æ®]
```

---

## 3. æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 3.1 æ•°æ®åŒæ­¥å¼•æ“ (`src/tushare_duckdb/`)

#### 3.1.1 æ¨¡å—èŒè´£

æ•°æ®åŒæ­¥å¼•æ“æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒï¼Œè´Ÿè´£ä» Tushare API è·å–æ•°æ®å¹¶å­˜å‚¨åˆ°æœ¬åœ° DuckDB æ•°æ®åº“ã€‚

| ç»„ä»¶ | æ–‡ä»¶ | èŒè´£ |
|------|------|------|
| **API å®¢æˆ·ç«¯** | `fetcher.py` | ä¸ Tushare API é€šä¿¡ã€åˆ†é¡µã€é‡è¯•ã€é™æµ |
| **æ•°æ®å¤„ç†** | `processor.py` | åè°ƒæ•°æ®è·å–ã€å¤„ç†å’Œå­˜å‚¨æµç¨‹ |
| **æ•°æ®å­˜å‚¨** | `storage.py` | DuckDB å­˜å‚¨æ“ä½œã€å­—æ®µæ˜ å°„ã€æ—¥æœŸæ ‡å‡†åŒ– |
| **æ•°æ®æ ¡éªŒ** | `data_validation.py` | æ•°æ®è´¨é‡æ£€æŸ¥ã€è¦†ç›–ç‡åˆ†æã€å¼‚å¸¸æ£€æµ‹ |
| **å…ƒæ•°æ®ç®¡ç†** | `metadata.py` | è¡¨ç»“æ„ä¿¡æ¯ã€ç»Ÿè®¡ä¿¡æ¯ã€æ›´æ–°è¿½è¸ª |
| **é…ç½®ç®¡ç†** | `config.py` | åŠ è½½ settings.yamlã€ç¯å¢ƒå˜é‡ |
| **æ—¥å¿—ç³»ç»Ÿ** | `logger.py` | ç»Ÿä¸€çš„æ—¥å¿—è®°å½• |
| **å·¥å…·å‡½æ•°** | `utils.py` | æ—¥æœŸå¤„ç†ã€è¿æ¥ç®¡ç†ã€é€šç”¨å‡½æ•° |

#### 3.1.2 TushareFetcher

**æ ¸å¿ƒèŒè´£**ï¼šå¤„ç†ä¸ Tushare API çš„æ‰€æœ‰é€šä¿¡ç»†èŠ‚

**å…³é”®åŠŸèƒ½**ï¼š
- **è‡ªåŠ¨åˆ†é¡µ**ï¼šå¤„ç† API çš„ 2000/5000 è¡Œé™åˆ¶
- **æ™ºèƒ½é‡è¯•**ï¼šç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•ï¼ŒæŒ‡æ•°é€€é¿
- **é™æµå¤„ç†**ï¼šæ£€æµ‹åˆ°é¢‘ç‡é™åˆ¶æ—¶ç­‰å¾… 65 ç§’
- **æ•°æ®å»é‡**ï¼šåŸºäºå”¯ä¸€é”®è‡ªåŠ¨å»é‡

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
class TushareFetcher:
    def fetch_data(self, api_name, params, fields, limit=5000):
        """
        ä» Tushare API è·å–æ•°æ®

        Args:
            api_name: API æ¥å£åç§°
            params: API å‚æ•°
            fields: éœ€è¦è·å–çš„å­—æ®µ
            limit: å•é¡µæœ€å¤§è®°å½•æ•°

        Returns:
            DataFrame: å»é‡åçš„æ•°æ®
        """
```

**æ•°æ®æµç¨‹**ï¼š
```
API å‚æ•°æ„å»º
    â†“
API è°ƒç”¨ (with limit/offset)
    â†“
æ£€æŸ¥å“åº”
    â”œâ”€ æˆåŠŸ â†’ æå–æ•°æ®
    â””â”€ å¤±è´¥ â†’ æ£€æŸ¥é”™è¯¯ç±»å‹
                â”œâ”€ é¢‘ç‡é™åˆ¶ â†’ ç­‰å¾… 65sï¼Œé‡è¯•
                â”œâ”€ ç½‘ç»œé”™è¯¯ â†’ æŒ‡æ•°é€€é¿ï¼Œé‡è¯•
                â””â”€ å…¶ä»–é”™è¯¯ â†’ æŠ›å‡ºå¼‚å¸¸
    â†“
æ•°æ®å»é‡ (åŸºäº unique_keys)
    â†“
è¿”å› DataFrame
```

#### 3.1.3 DataProcessor

**æ ¸å¿ƒèŒè´£**ï¼šåè°ƒæ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ï¼Œæ”¯æŒä¸‰ç§å¤„ç†æ¨¡å¼

**ä¸‰ç§å¤„ç†æ¨¡å¼**ï¼š

| æ¨¡å¼ | `date_param_mode` | é€‚ç”¨åœºæ™¯ | æ€§èƒ½ |
|------|------------------|---------|------|
| **é€æ—¥å¤„ç†** | `single` | æ—¥é¢‘æ•°æ®ï¼ˆdailyã€adj_factorï¼‰ | æœ€æ…¢ |
| **èŒƒå›´å¤„ç†** | `range` | æ”¯æŒæ—¥æœŸèŒƒå›´æŸ¥è¯¢çš„æ¥å£ï¼ˆshiborã€index_weightï¼‰ | ä¸­ç­‰ |
| **æ™ºèƒ½åˆ†é¡µ** | `full_paging` | åŸºç¡€ä¿¡æ¯è¡¨ã€å¿«ç…§è¡¨ï¼ˆopt_basicã€stock_basicï¼‰ | æœ€å¿« |

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
class DataProcessor:
    def process_dates(self, table_name, api_config_entry, unique_keys,
                     date_list, ...):
        """
        ä¸»å¤„ç†å…¥å£ï¼Œæ ¹æ® date_param_mode åˆ†å‘åˆ°å¯¹åº”å¤„ç†å™¨
        """

    def _process_daily(self, ...):
        """é€æ—¥å¤„ç†æ¨¡å¼ï¼šä¸ºæ¯ä¸ªæ—¥æœŸå•ç‹¬è°ƒç”¨ API"""

    def _process_range(self, ...):
        """èŒƒå›´å¤„ç†æ¨¡å¼ï¼šä¸€æ¬¡æ€§è·å–æ—¥æœŸèŒƒå›´æ•°æ®"""

    def _process_full_paging(self, ...):
        """æ™ºèƒ½åˆ†é¡µæ¨¡å¼ï¼šå¯¹æ¯”æœ¬åœ°æ•°æ®ï¼Œä»…è·å–æ–°æ•°æ®"""
```

**full_paging æ™ºèƒ½å¢é‡åŒæ­¥åŸç†**ï¼š
```
1. æŸ¥è¯¢æœ¬åœ°æ•°æ®åº“ï¼Œè·å–æœ€å¤§æ—¥æœŸï¼ˆæˆ–æœ€å¤§ IDï¼‰
2. ä»è¯¥æ—¥æœŸä¹‹åå¼€å§‹åˆ†é¡µæ‹‰å–æ•°æ®
3. ä½¿ç”¨ offset é€æ­¥éå†ï¼Œç›´åˆ°æ— æ•°æ®è¿”å›
4. å…¨é‡æ•°æ®é€šè¿‡åˆ†é¡µé€’å½’è·å–
5. å»é‡åå­˜å‚¨ï¼ˆåŸºäºå”¯ä¸€é”®ï¼‰
```

**å¤šå‚æ•°ç»„åˆä¼˜åŒ–**ï¼š
```python
# ç¤ºä¾‹ï¼šéœ€è¦åŒæ—¶æ‹‰å–å¤šä¸ªäº¤æ˜“æ‰€çš„æ•°æ®
required_params:
  exchange:
    - SSE
    - SZSE

# å¤„ç†å™¨è‡ªåŠ¨ç”Ÿæˆå‚æ•°ç½‘æ ¼ï¼š
param_grid = [
    {'exchange': 'SSE'},
    {'exchange': 'SZSE'}
]

# å¹¶è¡Œæˆ–ä¸²è¡Œå¤„ç†æ¯ä¸ªå‚æ•°ç»„åˆ
```

#### 3.1.4 DuckDBStorage

**æ ¸å¿ƒèŒè´£**ï¼šç®¡ç†æ‰€æœ‰ DuckDB å­˜å‚¨æ“ä½œ

**ä¸¤ç§å­˜å‚¨æ¨¡å¼**ï¼š

| æ¨¡å¼ | `storage_mode` | è¡Œä¸º | é€‚ç”¨åœºæ™¯ |
|------|---------------|------|---------|
| **å¢é‡æ’å…¥** | `insert_new` | æ£€æŸ¥å”¯ä¸€é”®ï¼Œä¸å­˜åœ¨åˆ™æ’å…¥ | æ—¥å¸¸å¢é‡æ›´æ–° |
| **è¦†ç›–æ¨¡å¼** | `replace` | åˆ é™¤æŒ‡å®šèŒƒå›´æ•°æ®ï¼Œé‡æ–°æ’å…¥ | ä¿®å¤å†å²æ•°æ® |

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
class DuckDBStorage:
    def store_data(self, table_name, df, unique_keys,
                   storage_mode='insert_new',
                   overwrite_start_date=None,
                   overwrite_end_date=None):
        """
        å­˜å‚¨æ•°æ®åˆ° DuckDB

        æµç¨‹ï¼š
        1. å­—æ®µæ˜ å°„ (API å­—æ®µ â†’ DB å­—æ®µ)
        2. æ—¥æœŸæ ‡å‡†åŒ– (YYYY-MM-DD â†’ YYYYMMDD)
        3. é‡‘èæ•°æ®é¢„å¤„ç† (ann_date/end_date å¡«å……)
        4. NULL æ—¥æœŸè¿‡æ»¤
        5. åˆ›å»ºä¸´æ—¶è§†å›¾
        6. æ‰§è¡Œ DELETE (å¦‚æœæ˜¯ replace æ¨¡å¼)
        7. æ‰§è¡Œ INSERT (å¸¦ NOT EXISTS æ£€æŸ¥)
        8. æ›´æ–°å…ƒæ•°æ®
        """
```

**ç‰¹æ®Šå¤„ç†**ï¼š
- **å­—æ®µæ˜ å°„**ï¼šæ”¯æŒ `field_mappings` é…ç½®ï¼Œå¦‚ `leading â†’ leading_stock`
- **é‡‘èæ•°æ®é¢„å¤„ç†**ï¼šè‡ªåŠ¨å¡«å…… `ann_date` å’Œ `end_date`
- **æ‰¹é‡ä¼˜åŒ–**ï¼šä½¿ç”¨ä¸´æ—¶è§†å›¾å’Œæ‰¹é‡ INSERT æå‡æ€§èƒ½

#### 3.1.5 DataValidator

**æ ¸å¿ƒèŒè´£**ï¼šæ•°æ®è´¨é‡æ ¡éªŒå’Œå¼‚å¸¸æ£€æµ‹

**æ ¡éªŒèƒ½åŠ›**ï¼š

| æ ¡éªŒç±»å‹ | æ–¹æ³• | è¯´æ˜ |
|---------|------|------|
| **è¦†ç›–ç‡åˆ†æ** | `check_coverage()` | è®¡ç®—å®é™…æ—¥æœŸ/ç†è®ºæ—¥æœŸæ¯”ä¾‹ |
| **ç¼ºå¤±æ—¥æœŸæ£€æµ‹** | `find_missing_dates()` | è¯†åˆ«æ•°æ®ç¼ºå¤±çš„äº¤æ˜“æ—¥ |
| **å¼‚å¸¸æ£€æµ‹** | `detect_anomalies()` | ä½¿ç”¨ Mean-2*Std ç®—æ³• |
| **ç»Ÿè®¡æŠ¥å‘Š** | `get_database_status()` | ç”Ÿæˆå®Œæ•´çš„æ•°æ®åº“çŠ¶æ€æŠ¥å‘Š |

**å¼‚å¸¸æ£€æµ‹ç®—æ³•**ï¼š
```python
def detect_anomalies(df, date_column, record_column, threshold=2):
    """
    ä½¿ç”¨ Mean-2*Std ç®—æ³•æ£€æµ‹æ•°æ®é‡å¼‚å¸¸çš„æ—¥æœŸ

    Args:
        df: æ•°æ® DataFrame
        date_column: æ—¥æœŸåˆ—å
        record_column: è®°å½•æ•°åˆ—å
        threshold: æ ‡å‡†å·®å€æ•°ï¼ˆé»˜è®¤ 2ï¼‰

    Returns:
        DataFrame: å¼‚å¸¸æ—¥æœŸåˆ—è¡¨
    """
    mean = df[record_column].mean()
    std = df[record_column].std()
    lower_bound = mean - threshold * std
    upper_bound = mean + threshold * std

    anomalies = df[
        (df[record_column] < lower_bound) |
        (df[record_column] > upper_bound)
    ]
    return anomalies
```

### 3.2 é‡åŒ–åˆ†æå¼•æ“ (`src/vix/`)

#### 3.2.1 æ¨¡å—èŒè´£

é‡åŒ–åˆ†æå¼•æ“ä¸“æ³¨äºæ³¢åŠ¨ç‡ï¼ˆVIXï¼‰è®¡ç®—å’Œç›¸å…³é‡åŒ–åˆ†æã€‚

| ç»„ä»¶ | æ–‡ä»¶ | èŒè´£ |
|------|------|------|
| **æ•°æ®åŠ è½½** | `data_loader.py` | ä» DuckDB åŠ è½½æœŸæƒå’Œ Shibor æ•°æ® |
| **VIX è®¡ç®—** | `calculator.py` | å®ç° CBOE VIX è®¡ç®—æ–¹æ³• |
| **é…ç½®ç®¡ç†** | `config.py` | VIX ç›¸å…³é…ç½®ï¼ˆæ”¯æŒçš„æ ‡çš„ã€æ•°æ®åº“è·¯å¾„ï¼‰ |
| **æ•°æ®åº“æ£€æŸ¥** | `inspect_db.py` | æ£€æŸ¥æ•°æ®åº“å¯ç”¨æ€§ |
| **è¿è¡Œå…¥å£** | `run.py` | CLI å‘½ä»¤è¡Œå…¥å£ |

#### 3.2.2 VIX è®¡ç®—æµç¨‹

```
ç”¨æˆ·è¾“å…¥ (start_date, end_date, underlying)
    â†“
1. åŠ è½½æœŸæƒæ•°æ®
   â”œâ”€ æŸ¥è¯¢ opt_basic (åˆçº¦è¯¦æƒ…)
   â”œâ”€ æŸ¥è¯¢ opt_daily (ä»·æ ¼æ•°æ®)
   â”œâ”€ åˆå¹¶å¹¶è¿‡æ»¤
   â””â”€ è®¡ç®—åˆ°æœŸæ—¶é—´
    â†“
2. åŠ è½½ Shibor æ•°æ®
   â”œâ”€ æŸ¥è¯¢ shibor è¡¨
   â”œâ”€ å‰å‘/åå‘å¡«å……
   â””â”€ æ’å€¼åˆ° 1-365 å¤©
    â†“
3. éå†æ¯ä¸ªäº¤æ˜“æ—¥
   â†“
4. é€‰æ‹©è¿‘æœˆå’Œæ¬¡è¿‘æœˆåˆçº¦
   â”œâ”€ ç­›é€‰åˆ°æœŸæ—¶é—´ >= 7 å¤©
   â”œâ”€ æ’åºåé€‰æ‹©æœ€è¿‘çš„ä¸¤ä¸ª
   â””â”€ è·å–å¯¹åº”çš„æ— é£é™©åˆ©ç‡
    â†“
5. è®¡ç®—æ¯ä¸ªæœŸé™çš„æ–¹å·®
   â”œâ”€ è®¡ç®—è¿œæœŸä»·æ ¼ F
   â”œâ”€ ç¡®å®š K0 (å¹³å€¼æ‰§è¡Œä»·)
   â”œâ”€ è®¡ç®—ä¸­é—´ä»· Q(K)
   â””â”€ æ±‚å’Œæ–¹å·®è´¡çŒ®
    â†“
6. åŠ æƒæ’å€¼åˆ° 30 å¤©
   â”œâ”€ è®¡ç®—æ—¶é—´æƒé‡ w
   â”œâ”€ åŠ æƒæ–¹å·®: VÂ² = Tâ‚Ïƒâ‚Â²w + Tâ‚‚Ïƒâ‚‚Â²(1-w)
   â””â”€ æœ€ç»ˆ VIX: 100 Ã— âˆš(VÂ² Ã— 365/30)
    â†“
7. è¾“å‡ºç»“æœ
   â”œâ”€ æ±‡æ€» CSV (VIXã€ä¸­é—´å˜é‡)
   â””â”€ è¯¦ç»† CSV (æ¯ä¸ªåˆçº¦çš„è´¡çŒ®)
```

#### 3.2.3 æ”¯æŒçš„æ ‡çš„

| ç±»å‹ | ä»£ç  | è¯´æ˜ | å¯¹åº”æŒ‡æ•° | äº¤æ˜“æ‰€ |
|------|------|------|---------|--------|
| **ETF æœŸæƒ** | 510050.SH | ä¸Šè¯ 50ETF | 000016.SH | SSE |
| | 510300.SH | æ²ªæ·± 300ETF | 000300.SH | SSE |
| | 510500.SH | ä¸­è¯ 500ETF | 000905.SH | SSE |
| | 588000.SH | ç§‘åˆ› 50ETF | 000688.SH | SSE |
| | 588080.SH | ç§‘åˆ› 50ETF | 000688.SH | SSE |
| | 159922.SZ | ä¸­è¯ 500ETF | 399905.SZ | SZSE |
| | 159919.SZ | æ²ªæ·± 300ETF | 399300.SZ | SZSE |
| | 159901.SZ | æ·±è¯ 100ETF | 399330.SZ | SZSE |
| | 159915.SZ | åˆ›ä¸šæ¿ETF | 399102.SZ | SZSE |
| **æŒ‡æ•°æœŸæƒ** | 000016.SH | ä¸Šè¯ 50æŒ‡æ•° | - | CFFEX |
| | 000300.SH | æ²ªæ·± 300æŒ‡æ•° | - | CFFEX |
| | 000852.SH | ä¸­è¯ 1000æŒ‡æ•° | - | CFFEX |

### 3.3 å¯è§†åŒ–å¼•æ“ (`dashboard/`)

#### 3.3.1 æ¨¡å—èŒè´£

æä¾›äº¤äº’å¼æ•°æ®å¯è§†åŒ–ä»ªè¡¨ç›˜ã€‚

| ç»„ä»¶ | æ–‡ä»¶ | èŒè´£ |
|------|------|------|
| **ä¸»åº”ç”¨** | `app.py` | ç»Ÿä¸€å…¥å£ã€å¯¼èˆªã€é¡µé¢è·¯ç”± |
| **æ•°æ®åŠ è½½å™¨** | `*_data_loader.py` | ä» DuckDB åŠ è½½æ•°æ®ï¼ˆå¸¦ç¼“å­˜ï¼‰ |
| **å›¾è¡¨ç”Ÿæˆ** | `*_charts.py` | ç”Ÿæˆ Plotly å›¾è¡¨ |

#### 3.3.2 æ¶æ„è®¾è®¡

```
app.py (ç»Ÿä¸€å…¥å£)
    â”œâ”€ å¯¼èˆªç³»ç»Ÿ (URL-based routing)
    â”‚   â””â”€ Query params: ?page=macro&sub=pmi
    â”œâ”€ é¡µé¢æ¸²æŸ“
    â”‚   â”œâ”€ é¦–é¡µ (æ•°æ®æ¦‚è§ˆ)
    â”‚   â”œâ”€ å®è§‚æ•°æ® (PMIã€ç¤¾èã€è´§å¸ä¾›åº”)
    â”‚   â”œâ”€ æŒ‡æ•°æ•°æ® (æ—¥çº¿ã€æƒé‡ã€æˆåˆ†è‚¡)
    â”‚   â””â”€ å¸‚åœºæ•°æ® (è‚¡ç¥¨ç»Ÿè®¡)
    â””â”€ å¸ƒå±€ä¸æ ·å¼
        â””â”€ Anthropic-inspired design system

æ•°æ®åŠ è½½å™¨ (å¸¦ @st.cache_data ç¼“å­˜)
    â”œâ”€ load_pmi_data()
    â”œâ”€ load_sf_data()
    â”œâ”€ load_index_data()
    â””â”€ load_stock_data()

å›¾è¡¨ç”Ÿæˆ (Plotly)
    â”œâ”€ æŠ˜çº¿å›¾ (è¶‹åŠ¿)
    â”œâ”€ çƒ­åŠ›å›¾ (PMIã€æŒ‡æ•°æ¶¨è·Œ)
    â”œâ”€ æŸ±çŠ¶å›¾ (ç»Ÿè®¡)
    â””â”€ ç»„åˆå›¾ (å¤šæŒ‡æ ‡)
```

#### 3.3.3 ç¼“å­˜ç­–ç•¥

```python
@st.cache_data(ttl=3600)  # ç¼“å­˜ 1 å°æ—¶
def load_pmi_data():
    """ä» DuckDB åŠ è½½ PMI æ•°æ®"""
    conn = get_db_connection()
    try:
        df = conn.execute("SELECT * FROM cn_pmi").fetchdf()
        # é¢„å¤„ç†
    finally:
        conn.close()
    return df
```

**ç¼“å­˜ä¼˜åŠ¿**ï¼š
- å‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°
- æå‡é¡µé¢å“åº”é€Ÿåº¦
- é™ä½ DuckDB è¿æ¥å‹åŠ›

### 3.4 å·¥å…·é›† (`utils/VIX/`)

#### 3.4.1 æ¨¡å—èŒè´£

æä¾›ç ”ç©¶å·¥å…·ã€æ•°æ®å¤„ç†è„šæœ¬å’Œå¯è§†åŒ–å‡½æ•°ã€‚

| ç±»å‹ | æ–‡ä»¶ | ç”¨é€” |
|------|------|------|
| **å›æµ‹æ¡†æ¶** | `bt_func.py` | Backtrader å›æµ‹ã€ç­–ç•¥è¯„ä¼° |
| **è®¡ç®—å‡½æ•°** | `calc_func.py` | VIX/SKEW è®¡ç®—ã€é‡åŒ–å›å½’ |
| **æ•°æ®è·å–** | `get_tushare_data.py` | ä» Tushare API è·å–æ•°æ® |
| | `get_local_data.py` | ä»æœ¬åœ° DuckDB è·å–æ•°æ® |
| **å¯è§†åŒ–** | `plotting.py` | ç­–ç•¥å¯è§†åŒ–ã€æŒ‡æ ‡å›¾ |
| | `plot_pmi.py` | PMI çƒ­åŠ›å›¾ |
| **å·¥å…·** | `utils.py` | CSV åŠ è½½ã€è¡¨æ ¼æ‰“å° |

#### 3.4.2 å›æµ‹æ¡†æ¶

```
ç­–ç•¥å®šä¹‰ (vix_over_quantile_bound_strategy)
    â”œâ”€ ä¿¡å·ç”Ÿæˆ
    â”‚   â”œâ”€ VIX < ä¸‹åˆ†ä½æ•° â†’ ä¹°å…¥
    â”‚   â””â”€ VIX > ä¸Šåˆ†ä½æ•° â†’ å–å‡º
    â””â”€ è®¢å•æ‰§è¡Œ
        â”œâ”€ å…¨ä»“ä¹°å…¥
        â””â”€ å…¨ä»“å–å‡º

å›æµ‹æ‰§è¡Œ (Backtrader)
    â”œâ”€ æ•°æ®æº (add_pandas_data)
    â”œâ”€ ç­–ç•¥æ³¨å…¥
    â”œâ”€ åˆå§‹èµ„é‡‘ (1,000,000)
    â””â”€ æ‰‹ç»­è´¹ (0.0003)

ç»©æ•ˆåˆ†æ (analysis_rets)
    â”œâ”€ å¹´åŒ–æ”¶ç›Šç‡
    â”œâ”€ å¹´åŒ–æ³¢åŠ¨ç‡
    â”œâ”€ å¤æ™®æ¯”ç‡
    â”œâ”€ æœ€å¤§å›æ’¤
    â”œâ”€ èƒœç‡
    â””â”€ ç›ˆäºæ¯”

äº¤æ˜“åˆ†æ (analysis_trade)
    â”œâ”€ å¹³å‡æŒä»“æ—¶é—´
    â”œâ”€ å¹³å‡ç›ˆåˆ©
    â”œâ”€ å¹³å‡äºæŸ
    â””â”€ ç›ˆäºåˆ†å¸ƒ
```

---

## 4. æ•°æ®æµè½¬å…¨æ™¯

### 4.1 æ•°æ®åŒæ­¥æµç¨‹

```
ç”¨æˆ·è¾“å…¥ (CLI/API)
    â†“
1. åŠ è½½é…ç½® (settings.yaml)
    â”œâ”€ æ•°æ®åº“è·¯å¾„
    â”œâ”€ è¡¨ç»“æ„å®šä¹‰
    â”œâ”€ API å‚æ•°
    â””â”€ å¤„ç†æ¨¡å¼
    â†“
2. ç”Ÿæˆæ—¥æœŸåˆ—è¡¨
    â”œâ”€ äº¤æ˜“æ—¥æ•°æ® â†’ æŸ¥è¯¢ trade_cal è¡¨
    â”œâ”€ è‡ªç„¶æ—¥æ•°æ® â†’ ç”Ÿæˆæ—¥æœŸèŒƒå›´
    â””â”€ å­£åº¦æ•°æ® â†’ ç”Ÿæˆå­£åº¦æœ«æ—¥æœŸ
    â†“
3. åˆå§‹åŒ–è¡¨ç»“æ„
    â”œâ”€ æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
    â”œâ”€ ä¸å­˜åœ¨åˆ™åˆ›å»º (CREATE TABLE)
    â””â”€ åˆå§‹åŒ–å…ƒæ•°æ®è¡¨
    â†“
4. æ•°æ®å¤„ç†å¾ªç¯
    â†“
5. å‚æ•°ç½‘æ ¼ç”Ÿæˆ
    â”œâ”€ å•å‚æ•° â†’ [{}]
    â”œâ”€ å¤šå‚æ•° â†’ ç”Ÿæˆç¬›å¡å°”ç§¯
    â””â”€ ts_code åˆ—è¡¨ â†’ [ts_code1, ts_code2, ...]
    â†“
6. æ ¹æ®æ¨¡å¼åˆ†å‘
    â”œâ”€ single â†’ é€æ—¥å¤„ç†
    â”œâ”€ range â†’ èŒƒå›´å¤„ç†
    â””â”€ full_paging â†’ æ™ºèƒ½åˆ†é¡µ
    â†“
7. API è°ƒç”¨ (TushareFetcher)
    â”œâ”€ åˆ†é¡µå¤„ç† (limit/offset)
    â”œâ”€ è‡ªåŠ¨é‡è¯• (3 æ¬¡)
    â”œâ”€ é™æµç­‰å¾… (65s)
    â””â”€ æ•°æ®å»é‡
    â†“
8. æ•°æ®é¢„å¤„ç†
    â”œâ”€ å­—æ®µæ˜ å°„
    â”œâ”€ æ—¥æœŸæ ‡å‡†åŒ–
    â”œâ”€ é‡‘èæ•°æ®å¡«å……
    â””â”€ NULL è¿‡æ»¤
    â†“
9. æ•°æ®å­˜å‚¨ (DuckDBStorage)
    â”œâ”€ åˆ›å»ºä¸´æ—¶è§†å›¾
    â”œâ”€ æ‰§è¡Œ DELETE (replace æ¨¡å¼)
    â”œâ”€ æ‰§è¡Œ INSERT (å¸¦ EXISTS æ£€æŸ¥)
    â””â”€ æ›´æ–°å…ƒæ•°æ®
    â†“
10. æ•°æ®æ ¡éªŒ (å¯é€‰)
    â”œâ”€ è¦†ç›–ç‡æ£€æŸ¥
    â”œâ”€ ç¼ºå¤±æ—¥æœŸæ£€æµ‹
    â””â”€ å¼‚å¸¸æ£€æµ‹
    â†“
å®Œæˆ â†’ è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
```

### 4.2 VIX è®¡ç®—æ•°æ®æµ

```
æœ¬åœ° DuckDB æ•°æ®åº“
    â”œâ”€ opt_basic (æœŸæƒåˆçº¦)
    â”œâ”€ opt_daily (æœŸæƒä»·æ ¼)
    â””â”€ shibor (æ— é£é™©åˆ©ç‡)
    â†“
data_loader.py
    â”œâ”€ fetch_option_data()
    â”‚   â”œâ”€ æŸ¥è¯¢ opt_basic
    â”‚   â”œâ”€ æŸ¥è¯¢ opt_daily
    â”‚   â”œâ”€ åˆå¹¶å¹¶è¿‡æ»¤
    â”‚   â””â”€ è®¡ç®—åˆ°æœŸæ—¶é—´
    â””â”€ get_shibor_interpolated()
        â”œâ”€ æŸ¥è¯¢ shibor
        â”œâ”€ å‰å‘/åå‘å¡«å……
        â””â”€ æ’å€¼åˆ° 1-365 å¤©
    â†“
calculator.py
    â”œâ”€ calculate_vix_for_date()
    â”‚   â”œâ”€ é€‰æ‹©è¿‘æœˆ/æ¬¡è¿‘æœˆ
    â”‚   â”œâ”€ è·å–æ— é£é™©åˆ©ç‡
    â”‚   â”œâ”€ è®¡ç®—æ–¹å·® (near + next)
    â”‚   â”œâ”€ åŠ æƒæ’å€¼
    â”‚   â””â”€ è®¡ç®— VIX
    â””â”€ å¾ªç¯å¤„ç†æ¯ä¸ªæ—¥æœŸ
    â†“
è¾“å‡º CSV æ–‡ä»¶
    â”œâ”€ vix_result_*.csv (æ±‡æ€»)
    â””â”€ vix_details_*.csv (è¯¦ç»†)
```

### 4.3 Dashboard æ•°æ®æµ

```
ç”¨æˆ·è®¿é—® (Streamlit)
    â†“
URL è·¯ç”± (?page=macro&sub=pmi)
    â†“
é¡µé¢æ¸²æŸ“
    â†“
æ•°æ®åŠ è½½ (@st.cache_data)
    â†“
DuckDB æŸ¥è¯¢
    â†“
æ•°æ®é¢„å¤„ç†
    â”œâ”€ æ—¥æœŸè½¬æ¢
    â”œâ”€ æ•°å€¼è½¬æ¢
    â””â”€ è¿‡æ»¤
    â†“
å›¾è¡¨ç”Ÿæˆ (Plotly)
    â”œâ”€ é…ç½®å›¾è¡¨ç±»å‹
    â”œâ”€ æ·»åŠ æ•°æ®ç³»åˆ—
    â”œâ”€ è®¾ç½®æ ·å¼
    â””â”€ é…ç½®äº¤äº’
    â†“
æ¸²æŸ“åˆ°é¡µé¢
    â””â”€ st.plotly_chart()
```

---

## 5. æŠ€æœ¯æ ˆè¯´æ˜

### 5.1 æ ¸å¿ƒæŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|---------|
| **Python** | 3.8+ | ä¸»è¦å¼€å‘è¯­è¨€ | ä¸°å¯Œçš„æ•°æ®ç§‘å­¦ç”Ÿæ€ |
| **DuckDB** | Latest | åˆ—å¼æ•°æ®åº“ | é«˜æ€§èƒ½ OLAPã€å•æ–‡ä»¶å­˜å‚¨ã€å‘é‡åŒ–æŸ¥è¯¢ |
| **Tushare Pro** | - | æ•°æ®æº API | ä¸­å›½æœ€å…¨é¢çš„é‡‘èæ•°æ®æ¥å£ |
| **Streamlit** | Latest | å¯è§†åŒ–æ¡†æ¶ | å¿«é€Ÿæ„å»ºäº¤äº’å¼ä»ªè¡¨ç›˜ |
| **Plotly** | Latest | å›¾è¡¨åº“ | äº¤äº’å¼å¯è§†åŒ–ã€æ”¯æŒå¤æ‚å›¾è¡¨ |

### 5.2 ä¾èµ–åº“

```python
# æ ¸å¿ƒä¾èµ–
pandas>=1.3.0        # æ•°æ®å¤„ç†
numpy>=1.21.0        # æ•°å€¼è®¡ç®—
duckdb>=0.8.0        # æ•°æ®åº“
tushare>=1.2.0       # æ•°æ®æº
PyYAML>=6.0          # é…ç½®è§£æ

# å¯è§†åŒ–
streamlit>=1.28.0    # Dashboard
plotly>=5.0.0        # å›¾è¡¨

# å·¥å…·
python-dotenv>=1.0.0  # ç¯å¢ƒå˜é‡
tabulate>=0.9.0       # è¡¨æ ¼æ ¼å¼åŒ–
watchdog>=3.0.0       # æ–‡ä»¶ç›‘æ§

# å¯é€‰ï¼ˆç”¨äºå›æµ‹ï¼‰
backtrader>=1.9.0     # å›æµ‹æ¡†æ¶
scipy>=1.7.0          # ç§‘å­¦è®¡ç®—
```

### 5.3 DuckDB é€‰å‹ç†ç”±

**ä¼˜åŠ¿**ï¼š
- âœ… **åˆ—å¼å­˜å‚¨**ï¼šåˆ†æå‹æŸ¥è¯¢æ€§èƒ½æä½³
- âœ… **å•æ–‡ä»¶**ï¼šæ— éœ€å®‰è£…æ•°æ®åº“æœåŠ¡ç«¯ï¼Œéƒ¨ç½²ç®€å•
- âœ… **å‘é‡åŒ–æ‰§è¡Œ**ï¼šåˆ©ç”¨ SIMD æŒ‡ä»¤åŠ é€Ÿ
- âœ… **SQL æ”¯æŒ**ï¼šå®Œæ•´çš„ SQL å…¼å®¹æ€§
- âœ… **Python é›†æˆ**ï¼šåŸç”Ÿ Python API
- âœ… **é›¶é…ç½®**ï¼šå¼€ç®±å³ç”¨
- âœ… **å†…å­˜é«˜æ•ˆ**ï¼šè‡ªåŠ¨å†…å­˜ç®¡ç†

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… å¤§è§„æ¨¡æ•°æ®èšåˆæŸ¥è¯¢
- âœ… æ—¶é—´åºåˆ—æ•°æ®åˆ†æ
- âœ… æ‰¹é‡æ•°æ®å¤„ç†
- âœ… æœ¬åœ°åŒ–æ•°æ®åˆ†æ

**ä¸é€‚ç”¨åœºæ™¯**ï¼š
- âŒ é«˜å¹¶å‘ OLTPï¼ˆé«˜é¢‘äº¤æ˜“ï¼‰
- âŒ éœ€è¦ä¸»ä»å¤åˆ¶
- âŒ éœ€è¦å¤æ‚çš„äº‹åŠ¡å¤„ç†

---

## 6. è®¾è®¡åŸåˆ™ä¸æ¨¡å¼

### 6.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™

#### 1. "Slow is Fast" (æ…¢å³æ˜¯å¿«)

**ç†å¿µ**ï¼š
- æ¨ç†ä¼˜å…ˆï¼Œåœ¨ç¼–å†™ä»£ç å‰è¿›è¡Œå……åˆ†çš„æ€è€ƒå’Œè®¾è®¡
- è´¨é‡è‡³ä¸Šï¼Œæ³¨é‡ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œé•¿æœŸç¨³å®šæ€§
- ç¨³å¥ç¬¬ä¸€ï¼Œä¼˜å…ˆç¡®ä¿ç³»ç»Ÿçš„å¯é æ€§å’Œæ•°æ®ä¸€è‡´æ€§

**å®è·µ**ï¼š
```python
# âœ… å¥½çš„åšæ³•ï¼šæ¸…æ™°çš„ç±»å‹æç¤ºå’Œæ–‡æ¡£å­—ç¬¦ä¸²
def store_data(
    table_name: str,
    df: pd.DataFrame,
    unique_keys: List[str],
    storage_mode: str = 'insert_new'
) -> int:
    """
    å°†æ•°æ®å­˜å‚¨åˆ° DuckDB è¡¨ä¸­

    Args:
        table_name: è¡¨å
        df: å¾…å­˜å‚¨çš„æ•°æ®
        unique_keys: å”¯ä¸€é”®åˆ—è¡¨ï¼Œç”¨äºå»é‡
        storage_mode: å­˜å‚¨æ¨¡å¼ ('insert_new' æˆ– 'replace')

    Returns:
        å®é™…å­˜å‚¨çš„è®°å½•æ•°
    """
    # å®ç°ä»£ç 
    pass

# âŒ é¿å…ï¼šæ¨¡ç³Šçš„å‘½åå’Œç¼ºä¹æ–‡æ¡£
def save(d, k, m='new'):
    # å®ç°ä»£ç 
    pass
```

#### 2. å…³æ³¨ç‚¹åˆ†ç¦»

**æ¨¡å—èŒè´£æ¸…æ™°**ï¼š
- `fetcher.py`ï¼šåªè´Ÿè´£ API è°ƒç”¨
- `processor.py`ï¼šåªè´Ÿè´£æµç¨‹åè°ƒ
- `storage.py`ï¼šåªè´Ÿè´£æ•°æ®åº“æ“ä½œ
- `validator.py`ï¼šåªè´Ÿè´£æ•°æ®æ ¡éªŒ

**å¥½å¤„**ï¼š
- é™ä½è€¦åˆåº¦
- æ˜“äºæµ‹è¯•
- ä¾¿äºç»´æŠ¤

#### 3. é…ç½®é©±åŠ¨

**æ‰€æœ‰ä¸šåŠ¡é€»è¾‘åœ¨ settings.yaml ä¸­å®šä¹‰**ï¼š
```yaml
stock:
  db_path: ${DB_ROOT}/tushare_duck_stock.db
  tables:
    daily:
      fields:
      - ts_code
      - trade_date
      - open
      - high
      - low
      - close
      - vol
      - amount
      unique_keys:
      - ts_code
      - trade_date
      requires_paging: true
      limit: 6000
      date_param_mode: single
```

**å¥½å¤„**ï¼š
- æ— éœ€ä¿®æ”¹ä»£ç å³å¯è°ƒæ•´
- æ”¯æŒçƒ­æ›´æ–°ï¼ˆé‡å¯åº”ç”¨ï¼‰
- æ˜“äºæ‰©å±•æ–°è¡¨

#### 4. é”™è¯¯å¤„ç†ä¸æ—¥å¿—

**ç»Ÿä¸€çš„é”™è¯¯å¤„ç†**ï¼š
```python
try:
    result = fetch_data(...)
except APIRateLimitError:
    logger.warning("è¾¾åˆ°è®¿é—®é¢‘ç‡é™åˆ¶ï¼Œç­‰å¾…é‡è¯•")
    time.sleep(65)
    retry()
except NetworkError as e:
    logger.error(f"ç½‘ç»œé”™è¯¯: {e}")
    raise
except Exception as e:
    logger.error(f"æœªçŸ¥é”™è¯¯: {e}")
    raise
```

**ç»“æ„åŒ–æ—¥å¿—**ï¼š
```python
logger.info(
    f"{table_name}: å¤„ç†å‚æ•°ç»„åˆ {grid_params}",
    extra={
        'table': table_name,
        'params': grid_params,
        'action': 'process'
    }
)
```

### 6.2 è®¾è®¡æ¨¡å¼

#### 1. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)

**åº”ç”¨åœºæ™¯**ï¼šä¸‰ç§æ•°æ®è·å–æ¨¡å¼

```python
class DataProcessor:
    def process_dates(self, ...):
        mode = api_config_entry.get('date_param_mode', 'single')

        if mode == 'full_paging':
            return self._process_full_paging(...)
        elif mode == 'range':
            return self._process_range(...)
        else:
            return self._process_daily(...)
```

#### 2. å·¥å‚æ¨¡å¼ (Factory Pattern)

**åº”ç”¨åœºæ™¯**ï¼šåˆ›å»ºä¸åŒç±»å‹çš„å¤„ç†å™¨

```python
INIT_TABLES_MAP = {
    'stock': lambda conn: init_tables_for_category(conn, [
        'daily', 'adj_factor', 'daily_basic'
    ]),
    'index': lambda conn: init_tables_for_category(conn, [
        'index_daily', 'index_dailybasic'
    ]),
}

# ä½¿ç”¨
init_func = INIT_TABLES_MAP.get(category)
init_func(conn)
```

#### 3. ä¸Šä¸‹æ–‡ç®¡ç†å™¨ (Context Manager)

**åº”ç”¨åœºæ™¯**ï¼šDuckDB è¿æ¥ç®¡ç†

```python
@contextmanager
def get_connection(db_path, read_only=True):
    conn = duckdb.connect(db_path, read_only=read_only)
    try:
        yield conn
    finally:
        conn.close()

# ä½¿ç”¨
with get_connection(db_path) as conn:
    result = conn.execute("SELECT * FROM table").fetchdf()
```

#### 4. è£…é¥°å™¨æ¨¡å¼ (Decorator Pattern)

**åº”ç”¨åœºæ™¯**ï¼šç¼“å­˜ã€æ—¥å¿—

```python
# Streamlit ç¼“å­˜
@st.cache_data(ttl=3600)
def load_pmi_data():
    conn = get_db_connection()
    return conn.execute("SELECT * FROM cn_pmi").fetchdf()

# æ—¥å¿—è®°å½•
def log_execution(func):
    def wrapper(*args, **kwargs):
        logger.info(f"å¼€å§‹æ‰§è¡Œ: {func.__name__}")
        start_time = time.time()
        try:
            result = func(*args, **kwargs)
            elapsed = time.time() - start_time
            logger.info(f"å®Œæˆæ‰§è¡Œ: {func.__name__}, è€—æ—¶: {elapsed:.2f}s")
            return result
        except Exception as e:
            logger.error(f"æ‰§è¡Œå¤±è´¥: {func.__name__}, é”™è¯¯: {e}")
            raise
    return wrapper
```

---

## 7. æ€§èƒ½ä¸æ‰©å±•æ€§

### 7.1 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. æ‰¹é‡æ“ä½œ

**ä¼˜åŒ–å‰**ï¼ˆé€æ¡æ’å…¥ï¼‰ï¼š
```python
for index, row in df.iterrows():
    conn.execute(f"INSERT INTO table VALUES {tuple(row)}")
```

**ä¼˜åŒ–å**ï¼ˆæ‰¹é‡æ’å…¥ï¼‰ï¼š
```python
conn.execute("CREATE TEMP VIEW temp_view AS SELECT * FROM df")
conn.execute("""
    INSERT INTO table
    SELECT * FROM temp_view
    WHERE NOT EXISTS (
        SELECT 1 FROM table
        WHERE unique_keys = temp_view.unique_keys
    )
""")
```

**æ€§èƒ½æå‡**ï¼š10-100 å€

#### 2. è¿æ¥æ± 

**ä¼˜åŒ–å‰**ï¼ˆæ¯æ¬¡åˆ›å»ºæ–°è¿æ¥ï¼‰ï¼š
```python
conn = duckdb.connect(db_path)
result = conn.execute(query).fetchdf()
conn.close()
```

**ä¼˜åŒ–å**ï¼ˆå¤ç”¨è¿æ¥ï¼‰ï¼š
```python
@contextmanager
def get_connection(db_path):
    conn = duckdb.connect(db_path)
    try:
        yield conn
    finally:
        conn.close()

# ä½¿ç”¨
with get_connection(db_path) as conn:
    result = conn.execute(query).fetchdf()
```

#### 3. ç¼“å­˜ç­–ç•¥

**Dashboard ç¼“å­˜**ï¼š
```python
@st.cache_data(ttl=3600)  # ç¼“å­˜ 1 å°æ—¶
def load_pmi_data():
    # æ•°æ®åŠ è½½é€»è¾‘
    pass
```

**VIX è®¡ç®—ç¼“å­˜**ï¼š
```python
@lru_cache(maxsize=128)
def get_shibor_interpolated(date):
    # Shibor æ’å€¼é€»è¾‘
    pass
```

#### 4. åˆ†é¡µä¼˜åŒ–

**æ™ºèƒ½åˆ†é¡µ**ï¼š
```python
# è‡ªåŠ¨è°ƒæ•´åˆ†é¡µå¤§å°
if estimated_rows < 1000:
    limit = 5000
elif estimated_rows < 10000:
    limit = 2000
else:
    limit = 1000
```

### 7.2 æ‰©å±•æ€§è®¾è®¡

#### 1. æ–°å¢æ•°æ®ç±»åˆ«

**æ­¥éª¤**ï¼š
1. åœ¨ `settings.yaml` ä¸­æ·»åŠ ç±»åˆ«é…ç½®
2. åœ¨ `INIT_TABLES_MAP` ä¸­æ·»åŠ åˆå§‹åŒ–å‡½æ•°
3. åœ¨ä¸»èœå•ä¸­æ·»åŠ é€‰é¡¹

**ç¤ºä¾‹**ï¼š
```yaml
new_category:
  db_path: ${DB_ROOT}/tushare_duck_new.db
  tables:
    new_table:
      fields:
      - field1
      - field2
      unique_keys:
      - id
      date_column: date
      date_param_mode: single
```

#### 2. æ–°å¢è®¡ç®—æ¨¡å—

**æ­¥éª¤**ï¼š
1. åˆ›å»ºæ–°æ¨¡å—ç›®å½• `src/new_module/`
2. å®ç° `data_loader.py`ã€`calculator.py`ã€`run.py`
3. æ·»åŠ é…ç½®æ–‡ä»¶ `src/new_module/config.py`

#### 3. æ–°å¢ Dashboard é¡µé¢

**æ­¥éª¤**ï¼š
1. åˆ›å»º `new_data_loader.py`
2. åˆ›å»º `new_charts.py`
3. åœ¨ `app.py` ä¸­æ·»åŠ è·¯ç”±

### 7.3 æ€§èƒ½åŸºå‡†

**æ•°æ®åŒæ­¥æ€§èƒ½**ï¼š

| æ“ä½œ | æ•°æ®é‡ | è€—æ—¶ | ååé‡ |
|------|-------|------|--------|
| è‚¡ç¥¨æ—¥çº¿ (å•æ—¥) | ~5,000 æ¡ | 2-5 ç§’ | 1,000-2,500 æ¡/ç§’ |
| æŒ‡æ•°æ—¥çº¿ (å•æ—¥) | ~15 æ¡ | 1-2 ç§’ | 10-15 æ¡/ç§’ |
| æœŸæƒæ—¥çº¿ (å•æ—¥) | ~50,000 æ¡ | 30-60 ç§’ | 800-1,600 æ¡/ç§’ |
| æœŸæƒåŸºç¡€ä¿¡æ¯ (å…¨é‡) | ~12,000 æ¡ | 20-40 ç§’ | 300-600 æ¡/ç§’ |

**VIX è®¡ç®—æ€§èƒ½**ï¼š

| èŒƒå›´ | æ—¥æœŸæ•° | è€—æ—¶ |
|------|-------|------|
| 1 å‘¨ | 5 | 2-5 ç§’ |
| 1 ä¸ªæœˆ | 20 | 8-15 ç§’ |
| 1 å¹´ | 250 | 60-120 ç§’ |
| 5 å¹´ | 1,250 | 5-10 åˆ†é’Ÿ |

**Dashboard æ€§èƒ½**ï¼š

| é¡µé¢ | æ•°æ®é‡ | åŠ è½½æ—¶é—´ |
|------|-------|---------|
| PMI çƒ­åŠ›å›¾ | ~1,000 æ¡ | < 1 ç§’ |
| æŒ‡æ•°æ—¥çº¿å›¾ | ~10,000 æ¡ | < 2 ç§’ |
| è‚¡ç¥¨ç»Ÿè®¡å›¾ | ~5,000 æ¡ | < 1 ç§’ |

---

## 8. æ€»ç»“

Droid-Tushare ç³»ç»Ÿé‡‡ç”¨äº†**æ¨¡å—åŒ–ã€å¯æ‰©å±•ã€é«˜æ€§èƒ½**çš„æ¶æ„è®¾è®¡ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°äº†å·¥ä¸šçº§çš„æ•°æ®ç®¡ç†å’Œé‡åŒ–åˆ†æèƒ½åŠ›ï¼š

1. **æ¸…æ™°çš„åˆ†å±‚æ¶æ„**ï¼šç”¨æˆ·å±‚ â†’ ä¸šåŠ¡å±‚ â†’ è®¿é—®å±‚ â†’ å­˜å‚¨å±‚
2. **æ™ºèƒ½çš„æ•°æ®åŒæ­¥**ï¼šä¸‰ç§å¤„ç†æ¨¡å¼ã€è‡ªåŠ¨åˆ†é¡µã€æ™ºèƒ½å¢é‡
3. **å¼ºå¤§çš„æ•°æ®æ ¡éªŒ**ï¼šè¦†ç›–ç‡åˆ†æã€å¼‚å¸¸æ£€æµ‹ã€å…ƒæ•°æ®è¿½è¸ª
4. **çµæ´»çš„é…ç½®é©±åŠ¨**ï¼šæ‰€æœ‰ä¸šåŠ¡é€»è¾‘åœ¨ settings.yaml ä¸­å®šä¹‰
5. **å®Œå–„çš„å¯è§†åŒ–**ï¼šäº¤äº’å¼ Dashboardã€å¤šç§å›¾è¡¨ç±»å‹
6. **ä¸“ä¸šçš„é‡åŒ–åˆ†æ**ï¼šCBOE VIX æ–¹æ³•ã€å›æµ‹æ¡†æ¶

è¿™å¥—æ¶æ„ä¸ºé‡åŒ–äº¤æ˜“è€…æä¾›äº†**å®Œæ•´çš„æ•°æ®è§£å†³æ–¹æ¡ˆ**ï¼Œä»æ•°æ®è·å–ã€å­˜å‚¨ã€æ ¡éªŒåˆ°åˆ†æã€å¯è§†åŒ–ï¼Œå…¨é“¾è·¯è¦†ç›–ï¼Œæ˜¯ä¸€ä¸ªæˆç†Ÿã€ç¨³å®šã€å¯æ‰©å±•çš„é‡‘èæ•°æ®åŸºç¡€è®¾æ–½ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - ç”¨æˆ·ä½¿ç”¨æŒ‡å—
- [VIX_GUIDE.md](VIX_GUIDE.md) - VIX è®¡ç®—æ¨¡å—è¯¦è§£
- [DEPLOYMENT.md](DEPLOYMENT.md) - è¿ç»´éƒ¨ç½²æŒ‡å—
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - æ•…éšœæ’é™¤ç™¾ç§‘
- [docs/](docs/) - é¡¹ç›®æ–‡æ¡£ç›®å½•

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2026-01-06
**ç»´æŠ¤è€…**: Robert
