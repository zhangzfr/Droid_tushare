# ğŸ“Š VIX è®¡ç®—æ¨¡å—å®Œæ•´æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Droid-Tushare é¡¹ç›®ä¸­çš„ VIXï¼ˆæ³¢åŠ¨ç‡æŒ‡æ•°ï¼‰è®¡ç®—æ¨¡å—ï¼ŒåŒ…æ‹¬è®¡ç®—æ–¹æ³•ã€æ•°æ®æºã€ç»“æœè§£è¯»å’Œå®æˆ˜æ¡ˆä¾‹ã€‚

---

## ğŸ“‹ ç›®å½•

- [1. VIX åŸºç¡€æ¦‚å¿µ](#1-vix-åŸºç¡€æ¦‚å¿µ)
- [2. CBOE VIX è®¡ç®—æ–¹æ³•](#2-cboe-vix-è®¡ç®—æ–¹æ³•)
- [3. æœ¬é¡¹ç›®å®ç°è¯¦è§£](#3-æœ¬é¡¹ç›®å®ç°è¯¦è§£)
- [4. æ•°æ®æºä¸å·®å¼‚](#4-æ•°æ®æºä¸å·®å¼‚)
- [5. ä½¿ç”¨æŒ‡å—](#5-ä½¿ç”¨æŒ‡å—)
- [6. ç»“æœè§£è¯»](#6-ç»“æœè§£è¯»)
- [7. æ”¯æŒçš„æ ‡çš„](#7-æ”¯æŒçš„æ ‡çš„)
- [8. é«˜çº§åº”ç”¨](#8-é«˜çº§åº”ç”¨)
- [9. å¸¸è§é—®é¢˜](#9-å¸¸è§é—®é¢˜)

---

## 1. VIX åŸºç¡€æ¦‚å¿µ

### 1.1 ä»€ä¹ˆæ˜¯ VIXï¼Ÿ

**VIXï¼ˆVolatility Indexï¼‰** æ˜¯è¡¡é‡å¸‚åœºå¯¹æœªæ¥ 30 å¤©æ³¢åŠ¨ç‡é¢„æœŸçš„æŒ‡æ•°ï¼Œä¹Ÿè¢«ç§°ä¸º"ææ…ŒæŒ‡æ•°"ã€‚

- **èµ·æº**ï¼šç”± CBOEï¼ˆèŠåŠ å“¥æœŸæƒäº¤æ˜“æ‰€ï¼‰äº 1993 å¹´æ¨å‡º
- **åŸç†**ï¼šåŸºäºæœŸæƒä»·æ ¼çš„åæ¨ï¼ˆæ— éœ€æ¨¡å‹ï¼‰
- **æ„ä¹‰**ï¼šåæ˜ å¸‚åœºå¯¹çŸ­æœŸæ³¢åŠ¨ç‡çš„é¢„æœŸ
- **åº”ç”¨**ï¼šé£é™©ç®¡ç†ã€äº¤æ˜“ç­–ç•¥ã€å¸‚åœºæƒ…ç»ªåˆ¤æ–­

### 1.2 VIX çš„æ„ä¹‰

| VIX æ°´å¹³ | å¸‚åœºçŠ¶æ€ | è§£è¯» |
|----------|---------|------|
| **0-15** | ä½æ³¢åŠ¨ | å¸‚åœºå¹³é™ï¼Œå¯èƒ½å¤„äºç‰›å¸‚ |
| **15-20** | æ­£å¸¸æ³¢åŠ¨ | å¸‚åœºå¤„äºæ­£å¸¸çŠ¶æ€ |
| **20-30** | é«˜æ³¢åŠ¨ | å¸‚åœºä¸ç¡®å®šï¼Œå¯èƒ½æœ‰è°ƒæ•´ |
| **30-50** | æç«¯æ³¢åŠ¨ | å¸‚åœºææ…Œï¼Œå¯èƒ½å‘ç”Ÿå±æœº |
| **50+** | å†å²æå€¼ | å¸‚åœºæåº¦ææ…Œï¼Œæš´è·Œæ¦‚ç‡é«˜ |

### 1.3 ä¸­å›½å¸‚åœºçš„ VIX

- **å®˜æ–¹æŒ‡æ•°**ï¼šä¸Šè¯ 50ETF æ³¢åŠ¨ç‡æŒ‡æ•°ï¼ˆiVIXï¼‰
- **äº¤æ˜“æ‰€**ï¼šä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€ï¼ˆSSEï¼‰
- **æ ‡çš„**ï¼š50ETF æœŸæƒï¼ˆ510050.SHï¼‰
- **ç‰¹ç‚¹**ï¼š
  - æµåŠ¨æ€§è¾ƒå¥½
  - åˆçº¦è®¾è®¡ä¸å›½é™…æ¥è½¨
  - æˆäº¤é‡é€æ­¥å¢é•¿

---

## 2. CBOE VIX è®¡ç®—æ–¹æ³•

### 2.1 æ ¸å¿ƒåŸç†

CBOE VIX é‡‡ç”¨**æ–¹å·®äº’æ¢ï¼ˆVariance Swapï¼‰**åŸç†ï¼Œæ— éœ€å‡è®¾ä»»ä½•æœŸæƒå®šä»·æ¨¡å‹ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼šé€šè¿‡æœŸæƒä»·æ ¼åæ¨å¸‚åœºå¯¹æ³¢åŠ¨ç‡çš„é¢„æœŸã€‚

### 2.2 è®¡ç®—å…¬å¼

#### 2.2.1 å•ä¸€æœŸé™çš„æ–¹å·®è®¡ç®—

å¯¹äºæ¯ä¸ªæœŸé™ï¼ˆè¿‘æœˆæˆ–æ¬¡è¿‘æœˆï¼‰ï¼Œæ–¹å·® ÏƒÂ² çš„è®¡ç®—å…¬å¼ä¸ºï¼š

$$ \sigma^2 = \frac{2}{T} \sum_{i} \frac{\Delta K_i}{K_i^2} e^{RT} Q(K_i) - \frac{1}{T} \left( \frac{F}{K_0} - 1 \right)^2 $$

**å‚æ•°è¯´æ˜**ï¼š
- `T`ï¼šåˆ°æœŸæ—¶é—´ï¼ˆä»¥å¹´ä¸ºå•ä½ï¼‰
- `K_i`ï¼šç¬¬ i ä¸ªæ‰§è¡Œä»·
- `Î”K_i`ï¼šæ‰§è¡Œä»·é—´è·ï¼ˆç›¸é‚»ä¸¤ä¸ªæ‰§è¡Œä»·å·®çš„ä¸€åŠï¼‰
- `F`ï¼šè¿œæœŸä»·æ ¼ï¼ˆForward Priceï¼‰
- `K_0`ï¼šå¹³å€¼æ‰§è¡Œä»·ï¼ˆStrike Cutoffï¼Œå°äº F çš„æœ€å¤§æ‰§è¡Œä»·ï¼‰
- `R`ï¼šæ— é£é™©åˆ©ç‡
- `Q(K_i)`ï¼šæœŸæƒä»·æ ¼ï¼ˆçœ‹æ¶¨æˆ–çœ‹è·Œï¼‰

**Q(K_i) çš„é€‰æ‹©è§„åˆ™**ï¼š
- å½“ `K_i < K_0` æ—¶ï¼š`Q(K_i) = Put(K_i)`ï¼ˆçœ‹è·ŒæœŸæƒä»·æ ¼ï¼‰
- å½“ `K_i > K_0` æ—¶ï¼š`Q(K_i) = Call(K_i)`ï¼ˆçœ‹æ¶¨æœŸæƒä»·æ ¼ï¼‰
- å½“ `K_i = K_0` æ—¶ï¼š`Q(K_i) = (Call(K_0) + Put(K_0)) / 2`ï¼ˆå¹³å€¼å–å¹³å‡ï¼‰

#### 2.2.2 åŒæœŸé™æ’å€¼åˆ° 30 å¤©

ä½¿ç”¨è¿‘æœˆå’Œæ¬¡è¿‘æœˆçš„æ–¹å·®ï¼Œæ’å€¼åˆ° 30 å¤©ï¼š

**æ—¶é—´æƒé‡**ï¼š
$$ w = \frac{T_2 - 30/365}{T_2 - T_1} $$

**åŠ æƒæ–¹å·®**ï¼š
$$ \sigma_{30}^2 = T_1 \cdot \sigma_1^2 \cdot w + T_2 \cdot \sigma_2^2 \cdot (1-w) $$

**æœ€ç»ˆ VIX**ï¼š
$$ \text{VIX} = 100 \times \sqrt{\sigma_{30}^2 \times \frac{365}{30}} $$

### 2.3 è®¡ç®—æµç¨‹

```
1. é€‰æ‹©è¿‘æœˆå’Œæ¬¡è¿‘æœˆåˆçº¦
   â”œâ”€ åˆ°æœŸæ—¶é—´ >= 7 å¤©
   â”œâ”€ è¿‘æœˆï¼šæœ€æ—©çš„åˆçº¦
   â””â”€ æ¬¡è¿‘æœˆï¼šæ¬¡æ—©çš„åˆçº¦

2. è®¡ç®—è¿œæœŸä»·æ ¼ F
   F = K_0 + e^{RT} Ã— (Call(K_0) - Put(K_0))

3. ç¡®å®šå¹³å€¼æ‰§è¡Œä»· K_0
   K_0 = å°äº F çš„æœ€å¤§æ‰§è¡Œä»·

4. è®¡ç®—æ¯ä¸ªæ‰§è¡Œä»·å¯¹æ–¹å·®çš„è´¡çŒ®
   è´¡çŒ® = (Î”K / KÂ²) Ã— e^{RT} Ã— Q(K)

5. æ±‚å’Œå¹¶å‡å»æ¼‚ç§»é¡¹
   ÏƒÂ² = (2/T) Ã— Î£è´¡çŒ® - (1/T) Ã— (F/K_0 - 1)Â²

6. å¯¹è¿‘æœˆå’Œæ¬¡è¿‘æœˆåˆ†åˆ«è®¡ç®— Ïƒâ‚Â² å’Œ Ïƒâ‚‚Â²

7. æ’å€¼åˆ° 30 å¤©
   VIX = 100 Ã— âˆš(Ïƒâ‚ƒâ‚€Â² Ã— 365/30)
```

---

## 3. æœ¬é¡¹ç›®å®ç°è¯¦è§£

### 3.1 æ¨¡å—ç»“æ„

```
src/vix/
â”œâ”€â”€ config.py          # VIX ç›¸å…³é…ç½®ï¼ˆæ•°æ®åº“è·¯å¾„ã€æ”¯æŒçš„æ ‡çš„ï¼‰
â”œâ”€â”€ data_loader.py     # æ•°æ®åŠ è½½ï¼ˆæœŸæƒã€Shiborï¼‰
â”œâ”€â”€ calculator.py      # VIX è®¡ç®—æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ inspect_db.py      # æ•°æ®åº“æ£€æŸ¥å·¥å…·
â””â”€â”€ run.py           # CLI å…¥å£
```

### 3.2 æ•°æ®åŠ è½½ (`data_loader.py`)

#### 3.2.1 æœŸæƒæ•°æ®åŠ è½½

**å‡½æ•°**ï¼š`fetch_option_data(start_date, end_date, underlying)`

**æ•°æ®æº**ï¼š
- `opt_basic` è¡¨ï¼šæœŸæƒåˆçº¦åŸºç¡€ä¿¡æ¯
- `opt_daily` è¡¨ï¼šæœŸæƒæ¯æ—¥ä»·æ ¼æ•°æ®

**å¤„ç†æµç¨‹**ï¼š
```python
def fetch_option_data(start_date, end_date, underlying):
    # 1. æŸ¥è¯¢ opt_basic
    df_basic = conn.execute(f"""
        SELECT ts_code, call_put, exercise_price,
               maturity_date, list_date, exchange
        FROM opt_basic
        WHERE ts_code LIKE '{underlying}%'
    """).fetchdf()

    # 2. æŸ¥è¯¢ opt_daily
    df_daily = conn.execute(f"""
        SELECT ts_code, trade_date, close
        FROM opt_daily
        WHERE trade_date BETWEEN '{start_date}' AND '{end_date}'
    """).fetchdf()

    # 3. åˆå¹¶
    df = df_basic.merge(df_daily, on='ts_code')

    # 4. è®¡ç®—åˆ°æœŸæ—¶é—´ï¼ˆå¹´ï¼‰
    df['maturity'] = (
        df['maturity_date'] - df['trade_date']
    ).dt.days / 365.0

    # 5. æ˜ å°„åˆçº¦ç±»å‹
    df['contract_type'] = df['call_put'].map({
        'C': 'call', 'P': 'put'
    })

    return df
```

**è¾“å‡ºå­—æ®µ**ï¼š
- `date`ï¼šäº¤æ˜“æ—¥æœŸ
- `exercise_price`ï¼šæ‰§è¡Œä»·ï¼ˆK_iï¼‰
- `close`ï¼šæœŸæƒæ”¶ç›˜ä»·
- `contract_type`ï¼šåˆçº¦ç±»å‹ï¼ˆcall/putï¼‰
- `maturity`ï¼šåˆ°æœŸæ—¶é—´ï¼ˆå¹´ï¼ŒTï¼‰
- `exchange`ï¼šäº¤æ˜“æ‰€

#### 3.2.2 Shibor æ•°æ®åŠ è½½ä¸æ’å€¼

**å‡½æ•°**ï¼š`get_shibor_interpolated(start_date, end_date)`

**æ•°æ®æº**ï¼š`shibor` è¡¨ï¼ˆæ— é£é™©åˆ©ç‡ï¼‰

**Shibor æœŸé™**ï¼š
- `on`ï¼šéš”å¤œ
- `1w`ï¼š1 å‘¨
- `2w`ï¼š2 å‘¨
- `1m`ï¼š1 ä¸ªæœˆ
- `3m`ï¼š3 ä¸ªæœˆ
- `6m`ï¼š6 ä¸ªæœˆ
- `9m`ï¼š9 ä¸ªæœˆ
- `1y`ï¼š1 å¹´

**æ’å€¼æµç¨‹**ï¼š
```python
def get_shibor_interpolated(start_date, end_date):
    # 1. æŸ¥è¯¢ Shibor æ•°æ®
    df = conn.execute("""
        SELECT date, on, `1w`, `2w`, `1m`, `3m`, `6m`, `9m`, `1y`
        FROM shibor
        WHERE date BETWEEN ? AND ?
    """, [start_date, end_date]).fetchdf()

    # 2. è½¬æ¢ä¸ºå°æ•°ï¼ˆç™¾åˆ†æ¯” â†’ å°æ•°ï¼‰
    df = df / 100.0

    # 3. å‰å‘å’Œåå‘å¡«å……
    df = df.fillna(method='ffill').fillna(method='bfill')

    # 4. æ˜ å°„åˆ°å¤©æ•°
    tenor_map = {
        'on': 1, '1w': 7, '2w': 14,
        '1m': 30, '3m': 90, '6m': 180,
        '9m': 270, '1y': 365
    }

    # 5. çº¿æ€§æ’å€¼åˆ° 1-365 å¤©
    dates = df['date']
    interpolated = {}

    for date in dates:
        values = df.loc[df['date'] == date].iloc[0, 1:].values
        tenors = list(tenor_map.values())

        # ä½¿ç”¨ numpy.interp æ’å€¼
        daily_rates = np.interp(range(1, 366), tenors, values)
        interpolated[date] = daily_rates

    return pd.DataFrame(interpolated, index=range(1, 366)).T
```

**è¾“å‡ºæ ¼å¼**ï¼š
- è¡Œï¼šæ—¥æœŸ
- åˆ—ï¼š1-365 å¤©
- å€¼ï¼šå¯¹åº”æœŸé™çš„ Shibor åˆ©ç‡ï¼ˆå°æ•°ï¼‰

### 3.3 VIX è®¡ç®— (`calculator.py`)

#### 3.3.1 å•æ—¥ VIX è®¡ç®—

**å‡½æ•°**ï¼š`calculate_vix_for_date(date, option_data, shibor_interp, underlying)`

**æ ¸å¿ƒé€»è¾‘**ï¼š
```python
def calculate_vix_for_date(date, option_data, shibor_interp, underlying):
    # 1. ç­›é€‰å½“æ—¥æœŸæƒæ•°æ®
    daily_options = option_data[option_data['date'] == date]

    # 2. é€‰æ‹©è¿‘æœˆå’Œæ¬¡è¿‘æœˆåˆçº¦
    near_term, next_term = select_terms(daily_options)

    # 3. è·å–æ— é£é™©åˆ©ç‡
    r_near = shibor_interp.loc[date, int(near_term['maturity'].iloc[0] * 365)]
    r_next = shibor_interp.loc[date, int(next_term['maturity'].iloc[0] * 365)]

    # 4. è®¡ç®—ä¸¤ä¸ªæœŸé™çš„æ–¹å·®
    sigma_sq_near = calculate_sigma_square(
        near_term, r_near, underlying
    )
    sigma_sq_next = calculate_sigma_square(
        next_term, r_next, underlying
    )

    # 5. æ’å€¼åˆ° 30 å¤©
    T1 = near_term['maturity'].iloc[0]
    T2 = next_term['maturity'].iloc[0]

    w = (T2 - 30/365) / (T2 - T1)
    weighted_variance = T1 * sigma_sq_near * w + T2 * sigma_sq_next * (1 - w)

    # 6. è®¡ç®— VIX
    vix = 100 * np.sqrt(weighted_variance * 365 / 30)

    return {
        'date': date,
        'vix': vix,
        'near_term': T1,
        'next_term': T2,
        'r_near': r_near,
        'r_next': r_next,
        'sigma_sq_near': sigma_sq_near,
        'sigma_sq_next': sigma_sq_next,
        'weighted_variance': weighted_variance,
        'weight': w,
        # ... å…¶ä»–ä¸­é—´å˜é‡
    }
```

#### 3.3.2 å•ä¸€æœŸé™çš„æ–¹å·®è®¡ç®—

**å‡½æ•°**ï¼š`calculate_sigma_square(term_data, risk_free_rate, underlying)`

**è®¡ç®—æ­¥éª¤**ï¼š
```python
def calculate_sigma_square(term_data, r, T):
    # 1. è®¡ç®—è¿œæœŸä»·æ ¼ F
    # é€‰æ‹© K0ï¼ˆå¹³å€¼æ‰§è¡Œä»·ï¼‰
    k0_data = term_data.sort_values('exercise_price')
    F = calculate_forward_price(k0_data, r, T)

    # 2. ç¡®å®š K0ï¼ˆå°äº F çš„æœ€å¤§æ‰§è¡Œä»·ï¼‰
    K0 = k0_data[k0_data['exercise_price'] < F]['exercise_price'].max()

    # 3. è®¡ç®—æ¯ä¸ªæ‰§è¡Œä»·çš„è´¡çŒ®
    contributions = []
    for _, row in k0_data.iterrows():
        K = row['exercise_price']

        # è®¡ç®— Î”K
        if K == k0_data['exercise_price'].min():
            delta_K = k0_data['exercise_price'].nsmallest(2)[1] - K
        elif K == k0_data['exercise_price'].max():
            delta_K = K - k0_data['exercise_price'].nlargest(2)[1]
        else:
            idx = k0_data[k0_data['exercise_price'] == K].index[0]
            delta_K = (
                k0_data['exercise_price'].iloc[idx+1] -
                k0_data['exercise_price'].iloc[idx-1]
            ) / 2

        # é€‰æ‹©æœŸæƒä»·æ ¼ Q(K)
        if K < K0:
            Q = row[row['contract_type'] == 'put']['close'].values[0]
        elif K > K0:
            Q = row[row['contract_type'] == 'call']['close'].values[0]
        else:
            call_price = row[row['contract_type'] == 'call']['close'].values[0]
            put_price = row[row['contract_type'] == 'put']['close'].values[0]
            Q = (call_price + put_price) / 2

        # è®¡ç®—è´¡çŒ®
        contribution = (
            delta_K / (K ** 2) *
            np.exp(r * T) *
            Q
        )
        contributions.append(contribution)

    # 4. æ±‚å’Œ
    sum_contributions = sum(contributions)

    # 5. è®¡ç®—æ–¹å·®
    sigma_sq = (
        2 / T * sum_contributions -
        1 / T * (F / K0 - 1) ** 2
    )

    return sigma_sq
```

### 3.4 CLI å…¥å£ (`run.py`)

**å‘½ä»¤è¡Œä½¿ç”¨**ï¼š
```bash
python -m src.vix.run --start_date 20240101 --end_date 20240131 --underlying 510050.SH
```

**å‚æ•°è¯´æ˜**ï¼š
- `--start_date`ï¼šå¼€å§‹æ—¥æœŸï¼ˆYYYYMMDDï¼‰
- `--end_date`ï¼šç»“æŸæ—¥æœŸï¼ˆYYYYMMDDï¼‰
- `--underlying`ï¼šæ ‡çš„ä»£ç ï¼ˆé»˜è®¤ 510050.SHï¼‰

**è¾“å‡ºæ–‡ä»¶**ï¼š
- `data/vix_result_{underlying}_{start_date}_{end_date}.csv`ï¼šæ±‡æ€»ç»“æœ
- `data/vix_details_near_{underlying}_{start_date}_{end_date}.csv`ï¼šè¿‘æœˆè¯¦ç»†æ•°æ®
- `data/vix_details_next_{underlying}_{start_date}_{end_date}.csv`ï¼šæ¬¡è¿‘æœˆè¯¦ç»†æ•°æ®

---

## 4. æ•°æ®æºä¸å·®å¼‚

### 4.1 æœ¬é¡¹ç›®æ•°æ®æº

| æ•°æ®ç±»å‹ | æ¥æº | è¡¨å | è¯´æ˜ |
|---------|------|------|------|
| **æœŸæƒä»·æ ¼** | Tushare â†’ DuckDB | `opt_basic`, `opt_daily` | æ”¶ç›˜ä»· |
| **æ— é£é™©åˆ©ç‡** | Tushare â†’ DuckDB | `shibor` | ä¸Šæµ·é“¶è¡Œé—´åŒä¸šæ‹†æ”¾åˆ©ç‡ |

### 4.2 ä¸å®˜æ–¹ iVIX çš„å·®å¼‚

#### 4.2.1 æœŸæƒä»·æ ¼æ•°æ®

| é¡¹ç›® | æœ¬é¡¹ç›® | å®˜æ–¹ iVIX | å·®å¼‚å½±å“ |
|------|--------|-----------|---------|
| **ä»·æ ¼ç±»å‹** | æ”¶ç›˜ä»·ï¼ˆcloseï¼‰ | ä¹°å–ä»·ä¸­å€¼ï¼ˆmid-quoteï¼‰ | ä¸­ç­‰ |
| **æµåŠ¨æ€§** | å¯èƒ½å—æœ€åä¸€ç¬”æˆäº¤å½±å“ | ç»¼åˆä¹°å–ç›˜å£ | ä½-ä¸­ |
| **æ—¶é—´ç‚¹** | æ”¶ç›˜æ—¶åˆ» | å®æ—¶è®¡ç®— | ä½ |

**å½±å“åˆ†æ**ï¼š
- æ”¶ç›˜ä»·å¯èƒ½åç¦»ä¹°å–ä»·ä¸­å€¼ï¼Œå¼•å…¥éšæœºå™ªéŸ³
- å¯¹äºæµåŠ¨æ€§å·®çš„æ·±åº¦è™šå€¼åˆçº¦ï¼Œå·®å¼‚æ›´å¤§
- æ€»ä½“å½±å“ï¼šVIX å¯èƒ½åä½æˆ–æ³¢åŠ¨æ›´å¤§

#### 4.2.2 æ— é£é™©åˆ©ç‡

| é¡¹ç›® | æœ¬é¡¹ç›® | å®˜æ–¹ iVIX | å·®å¼‚å½±å“ |
|------|--------|-----------|---------|
| **åˆ©ç‡æ¥æº** | Shiborï¼ˆé“¶è¡Œé—´åŒä¸šæ‹†æ”¾åˆ©ç‡ï¼‰ | å›½å€ºæ”¶ç›Šç‡æ›²çº¿ | æä½ |
| **ä¿¡ç”¨é£é™©** | åŒ…å«é“¶è¡Œä¿¡ç”¨é£é™© | æ— ä¿¡ç”¨é£é™© | æä½ |
| **æ’å€¼æ–¹æ³•** | çº¿æ€§æ’å€¼ï¼ˆ1-365 å¤©ï¼‰ | æ’å€¼åˆ°ç²¾ç¡®æœŸé™ | æä½ |

**å½±å“åˆ†æ**ï¼š
- Shibor é€šå¸¸æ¯”å›½å€ºæ”¶ç›Šç‡é«˜ï¼ˆä¿¡ç”¨é£é™©æº¢ä»·ï¼‰
- åˆ©ç‡é¡¹ e^{RT} ä¸­ T è¾ƒå°ï¼ˆ< 0.1 å¹´ï¼‰ï¼ŒR çš„å¾®å°å·®å¼‚å½±å“æå°
- æ€»ä½“å½±å“ï¼š< 0.01 ä¸ª VIX ç‚¹ä½

#### 4.2.3 æœŸé™è®¡ç®—

| é¡¹ç›® | æœ¬é¡¹ç›® | å®˜æ–¹ iVIX | å·®å¼‚å½±å“ |
|------|--------|-----------|---------|
| **ç²¾åº¦** | è‡ªç„¶æ—¥ï¼ˆå¤©ï¼‰ | äº¤æ˜“åˆ†é’Ÿ | ä¸­ç­‰ |
| **è®¡ç®—** | (åˆ°æœŸæ—¥ - å½“å‰æ—¥) / 365 | ç²¾ç¡®åˆ°åˆ†é’Ÿ | ä¸­ç­‰ |
| **å½±å“æ—¶åˆ»** | ä¸´è¿‘åˆ°æœŸæ—¥æ—¶è¾ƒå¤§ | å…¨ç¨‹ç²¾ç¡® | ä¸­-é«˜ |

**å½±å“åˆ†æ**ï¼š
- æœ¬é¡¹ç›®ä½¿ç”¨è‡ªç„¶æ—¥ï¼Œå¿½ç•¥å‘¨æœ«å’ŒèŠ‚å‡æ—¥
- å®˜æ–¹ä½¿ç”¨äº¤æ˜“åˆ†é’Ÿï¼Œæ›´ç²¾ç¡®
- ä¸´è¿‘åˆ°æœŸæ—¥æ—¶ï¼ˆT < 7 å¤©ï¼‰ï¼Œç²¾åº¦å·®å¼‚æ”¾å¤§
- æ€»ä½“å½±å“ï¼šè¿‘æœˆåˆçº¦å¯èƒ½æœ‰ 0.1-0.5 ä¸ª VIX ç‚¹ä½åå·®

#### 4.2.4 åˆçº¦å®Œæ•´æ€§

| é¡¹ç›® | æœ¬é¡¹ç›® | å®˜æ–¹ iVIX | å·®å¼‚å½±å“ |
|------|--------|-----------|---------|
| **åˆçº¦èŒƒå›´** | å–å†³äºæ•°æ®åº“å®Œæ•´æ€§ | æ‰€æœ‰æŒ‚ç‰Œåˆçº¦ | é«˜ |
| **æ·±åº¦è™šå€¼** | å¯èƒ½ç¼ºå¤± | å®Œæ•´åŒ…å« | é«˜ |
| **å¼‚å¸¸æ£€æµ‹** | éœ€è¦äººå·¥æ£€æŸ¥ | å†…ç½®éªŒè¯ | ä¸­ |

**å½±å“åˆ†æ**ï¼š
- å¦‚æœæ•°æ®åº“ç¼ºå¤±æ·±åº¦è™šå€¼åˆçº¦ï¼ˆå°¤å…¶æ˜¯ Putï¼‰ï¼Œç§¯åˆ†é¡¹ä¸å®Œæ•´
- ç¼ºå¤±çš„åˆçº¦é€šå¸¸æ˜¯é»‘å¤©é¹…ä¿æŠ¤ï¼Œå¯¹ VIX è´¡çŒ®è¾ƒå¤§
- æ€»ä½“å½±å“ï¼šVIX å¯èƒ½æ˜¾è‘—åä½ï¼ˆ0.5-2 ä¸ªç‚¹ä½ï¼‰

### 4.3 æ•°æ®è´¨é‡å»ºè®®

#### 4.3.1 ç¡®ä¿åˆçº¦å®Œæ•´æ€§

```bash
# æ£€æŸ¥ opt_basic æ•°æ®å®Œæ•´æ€§
python -c "
import duckdb
conn = duckdb.connect('tushare_duck_opt.db')
df = conn.execute('SELECT * FROM opt_basic WHERE ts_code LIKE \"510050.SH%\"').fetchdf()
print(f'æ€»åˆçº¦æ•°: {len(df)}')
print(f'åˆ°æœŸæ—¥æœŸèŒƒå›´: {df[\"maturity_date\"].min()} è‡³ {df[\"maturity_date\"].max()}')
"
```

#### 4.3.2 éªŒè¯æœŸæƒä»·æ ¼

```python
# æ£€æŸ¥ä»·æ ¼å¼‚å¸¸
import pandas as pd

df = pd.read_csv('vix_details_near_510050.SH_20240101_20240131.csv')

# æŸ¥æ‰¾ä»·æ ¼ä¸º 0 æˆ–å¼‚å¸¸é«˜çš„è®°å½•
abnormal = df[
    (df['call'] <= 0) |
    (df['put'] <= 0) |
    (df['call'] > 10) |  # å‡è®¾åˆç†ä¸Šé™
    (df['put'] > 10)
]

print(f'å¼‚å¸¸ä»·æ ¼è®°å½•æ•°: {len(abnormal)}')
print(abnormal.head())
```

#### 4.3.3 æ£€æŸ¥ Shibor æ•°æ®

```python
# æ£€æŸ¥ Shibor æ’å€¼ç»“æœ
import pandas as pd

shibor_interp = pd.read_csv('data/shibor_interpolated.csv', index_col=0)

# æ£€æŸ¥ç¼ºå¤±å€¼
missing = shibor_interp.isnull().sum()
print(f'ç¼ºå¤±å€¼æ•°é‡: {missing.sum()}')

# æ£€æŸ¥å¼‚å¸¸å€¼
abnormal = shibor_interp[
    (shibor_interp < 0) |  # è´Ÿåˆ©ç‡
    (shibor_interp > 0.10)  # è¶…è¿‡ 10%
]
print(f'å¼‚å¸¸åˆ©ç‡è®°å½•æ•°: {len(abnormal)}')
```

---

## 5. ä½¿ç”¨æŒ‡å—

### 5.1 åŸºç¡€ä½¿ç”¨

#### 5.1.1 é¦–æ¬¡è®¡ç®—

```bash
# è®¡ç®—ä¸Šè¯ 50ETF çš„ VIXï¼ˆé»˜è®¤æ ‡çš„ï¼‰
python -m src.vix.run --start_date 20240101 --end_date 20240131

# è®¡ç®—æ²ªæ·± 300ETF çš„ VIX
python -m src.vix.run \
  --start_date 20240101 \
  --end_date 20240131 \
  --underlying 510300.SH
```

#### 5.1.2 è¾“å‡ºæ–‡ä»¶

**æ±‡æ€»ç»“æœæ–‡ä»¶**ï¼ˆ`vix_result_*.csv`ï¼‰ï¼š

| åˆ—å | å«ä¹‰ | ç¤ºä¾‹å€¼ |
|------|------|--------|
| `date` | äº¤æ˜“æ—¥æœŸ | 20240101 |
| `vix` | VIX æŒ‡æ•° | 15.23 |
| `near_term` | è¿‘æœˆæœŸé™ï¼ˆå¹´ï¼‰ | 0.030 |
| `next_term` | æ¬¡è¿‘æœˆæœŸé™ï¼ˆå¹´ï¼‰ | 0.085 |
| `r_near` | è¿‘æœˆæ— é£é™©åˆ©ç‡ | 0.0203 |
| `r_next` | æ¬¡è¿‘æœˆæ— é£é™©åˆ©ç‡ | 0.0215 |
| `sigma_sq_near` | è¿‘æœˆæ–¹å·® | 0.0456 |
| `sigma_sq_next` | æ¬¡è¿‘æœˆæ–¹å·® | 0.0489 |
| `F_near` | è¿‘æœˆè¿œæœŸä»·æ ¼ | 2.85 |
| `F_next` | æ¬¡è¿‘æœˆè¿œæœŸä»·æ ¼ | 2.87 |
| `K0_near` | è¿‘æœˆå¹³å€¼æ‰§è¡Œä»· | 2.85 |
| `K0_next` | æ¬¡è¿‘æœˆå¹³å€¼æ‰§è¡Œä»· | 2.85 |
| `weight` | æ—¶é—´æƒé‡ | 0.65 |
| `weighted_variance` | åŠ æƒæ–¹å·® | 0.0472 |

**è¯¦ç»†æ–‡ä»¶**ï¼ˆ`vix_details_*.csv`ï¼‰ï¼š

| åˆ—å | å«ä¹‰ |
|------|------|
| `date` | äº¤æ˜“æ—¥æœŸ |
| `exercise_price` | æ‰§è¡Œä»·ï¼ˆK_iï¼‰ |
| `call` | çœ‹æ¶¨æœŸæƒä»·æ ¼ |
| `put` | çœ‹è·ŒæœŸæƒä»·æ ¼ |
| `diff` | æ‰§è¡Œä»·é—´è·ï¼ˆÎ”K_iï¼‰ |
| `risk_free_rate` | æ— é£é™©åˆ©ç‡ |
| `maturity` | åˆ°æœŸæ—¶é—´ï¼ˆTï¼‰ |
| `F` | è¿œæœŸä»·æ ¼ |
| `K0` | å¹³å€¼æ‰§è¡Œä»· |
| `Q_K` | æœŸæƒä»·æ ¼ï¼ˆQ(K_i)ï¼‰ |
| `contribution` | å¯¹æ–¹å·®çš„è´¡çŒ® |

### 5.2 é«˜çº§ä½¿ç”¨

#### 5.2.1 Python API è°ƒç”¨

```python
from src.vix.data_loader import fetch_option_data, get_shibor_interpolated
from src.vix.calculator import calculate_vix_for_date
import pandas as pd

# åŠ è½½æ•°æ®
option_data = fetch_option_data(
    start_date='20240101',
    end_date='20240131',
    underlying='510050.SH'
)

shibor_interp = get_shibor_interpolated(
    start_date='20240101',
    end_date='20240131'
)

# è®¡ç®—æ¯ä¸ªäº¤æ˜“æ—¥çš„ VIX
results = []
for date in pd.date_range('20240101', '20240131'):
    date_str = date.strftime('%Y%m%d')

    try:
        vix_result = calculate_vix_for_date(
            date=date_str,
            option_data=option_data,
            shibor_interp=shibor_interp,
            underlying='510050.SH'
        )
        results.append(vix_result)
    except Exception as e:
        print(f"è®¡ç®—å¤±è´¥ {date_str}: {e}")

# è½¬æ¢ä¸º DataFrame
df_result = pd.DataFrame(results)
print(df_result[['date', 'vix', 'near_term', 'next_term']])
```

#### 5.2.2 æ‰¹é‡è®¡ç®—å¤šä¸ªæ ‡çš„

```bash
#!/bin/bash

UNDERLYINGS=(
  "510050.SH"
  "510300.SH"
  "510500.SH"
  "588000.SH"
)

START_DATE="20240101"
END_DATE="20240131"

for underlying in "${UNDERLYINGS[@]}"; do
  echo "è®¡ç®— $underlying çš„ VIX..."
  python -m src.vix.run \
    --start_date $START_DATE \
    --end_date $END_DATE \
    --underlying $underlying
done

echo "æ‰€æœ‰è®¡ç®—å®Œæˆï¼"
```

#### 5.2.3 å¼‚å¸¸è¯Šæ–­

å½“å‘ç°æŸå¤© VIX å¼‚å¸¸æ—¶ï¼Œä½¿ç”¨è¯¦ç»†æ–‡ä»¶è¿›è¡Œè¯Šæ–­ï¼š

```python
import pandas as pd

# åŠ è½½è¯¦ç»†æ•°æ®
details = pd.read_csv('data/vix_details_near_510050.SH_20240101_20240131.csv')

# ç­›é€‰å¼‚å¸¸æ—¥æœŸï¼ˆå‡è®¾ 20240115 å¼‚å¸¸ï¼‰
date = '20240115'
abnormal_date = details[details['date'] == date]

# æŒ‰è´¡çŒ®æ’åº
abnormal_date_sorted = abnormal_date.sort_values('contribution', ascending=False)

# æŸ¥çœ‹è´¡çŒ®æœ€å¤§çš„ 10 ä¸ªåˆçº¦
print("è´¡çŒ®æœ€å¤§çš„ 10 ä¸ªåˆçº¦ï¼š")
print(abnormal_date_sorted[['exercise_price', 'call', 'put', 'contribution']].head(10))

# æ£€æŸ¥ä»·æ ¼æ˜¯å¦å¼‚å¸¸
print("\nä»·æ ¼ç»Ÿè®¡ï¼š")
print(abnormal_date_sorted[['call', 'put']].describe())
```

### 5.3 æ€§èƒ½ä¼˜åŒ–

#### 5.3.1 æ•°æ®ç¼“å­˜

```python
from joblib import Memory
import os

# è®¾ç½®ç¼“å­˜ç›®å½•
cache_dir = './cache/vix_cache'
os.makedirs(cache_dir, exist_ok=True)
memory = Memory(cache_dir, verbose=0)

@memory.cache
def cached_calculate_vix(date, underlying):
    # è®¡ç®—é€»è¾‘
    pass
```

#### 5.3.2 å¹¶è¡Œè®¡ç®—

```python
from concurrent.futures import ThreadPoolExecutor
import pandas as pd

def calculate_vix_wrapper(date):
    try:
        return calculate_vix_for_date(...)
    except Exception as e:
        print(f"è®¡ç®—å¤±è´¥ {date}: {e}")
        return None

# ä½¿ç”¨çº¿ç¨‹æ± å¹¶è¡Œè®¡ç®—
dates = pd.date_range('20240101', '20241231')

with ThreadPoolExecutor(max_workers=4) as executor:
    results = list(executor.map(calculate_vix_wrapper, dates))

# è¿‡æ»¤æ‰ None
results = [r for r in results if r is not None]
```

---

## 6. ç»“æœè§£è¯»

### 6.1 VIX æ°´å¹³è§£è¯»

#### 6.1.1 å†å²åˆ†ä½æ•°

```python
import pandas as pd

# åŠ è½½å†å² VIX æ•°æ®
df = pd.read_csv('data/vix_result_510050.SH_20200101_20241231.csv')

# è®¡ç®—åˆ†ä½æ•°
percentiles = df['vix'].describe(percentiles=[0.1, 0.25, 0.5, 0.75, 0.9])

print("VIX å†å²åˆ†ä½æ•°ï¼š")
print(percentiles)
```

**ç¤ºä¾‹è¾“å‡º**ï¼š
```
count    1230.000000
mean       18.523412
std         5.234567
min         10.120000
10%         12.450000
25%         14.890000
50%         17.230000
75%         21.450000
90%         25.670000
max         45.890000
```

**è§£è¯»**ï¼š
- **VIX < 12.45**ï¼šå†å²æœ€ä½ 10%ï¼Œæåº¦å¹³é™
- **VIX = 17.23**ï¼šå†å²ä¸­ä½æ•°ï¼Œæ­£å¸¸æ°´å¹³
- **VIX > 25.67**ï¼šå†å²æœ€é«˜ 10%ï¼Œæåº¦ææ…Œ

#### 6.1.2 VIX ä¸å¸‚åœºæ¶¨è·Œ

```python
import pandas as pd
import matplotlib.pyplot as plt

# åŠ è½½ VIX å’ŒæŒ‡æ•°æ•°æ®
vix_df = pd.read_csv('data/vix_result_510050.SH_20240101_20240131.csv')
index_df = pd.read_csv('data/510050_daily_20240101_20240131.csv')

# è®¡ç®— VIX å˜åŒ–ç‡å’ŒæŒ‡æ•°æ”¶ç›Šç‡
vix_df['vix_change'] = vix_df['vix'].pct_change()
index_df['index_return'] = index_df['close'].pct_change()

# åˆå¹¶
merged = pd.merge(
    vix_df[['date', 'vix_change']],
    index_df[['trade_date', 'index_return']],
    left_on='date',
    right_on='trade_date'
)

# è®¡ç®—ç›¸å…³æ€§
correlation = merged['vix_change'].corr(merged['index_return'])
print(f"VIX å˜åŒ–ç‡ä¸æŒ‡æ•°æ”¶ç›Šç‡çš„ç›¸å…³æ€§: {correlation:.3f}")

# æ•£ç‚¹å›¾
plt.scatter(merged['vix_change'], merged['index_return'])
plt.xlabel('VIX Change')
plt.ylabel('Index Return')
plt.title('VIX vs Index Return')
plt.show()
```

**å…¸å‹è§„å¾‹**ï¼š
- VIX ä¸Šæ¶¨ â†’ å¸‚åœºä¸‹è·Œï¼ˆè´Ÿç›¸å…³ï¼‰
- VIX è¾¾åˆ°é«˜ä½ â†’ å¸‚åœºåº•éƒ¨ä¸´è¿‘
- VIX æŒç»­ä½ä½ â†’ å¸‚åœºå¯èƒ½è§é¡¶

### 6.2 ä¸­é—´å˜é‡è§£è¯»

#### 6.2.1 è¿‘æœˆ vs æ¬¡è¿‘æœˆ

```python
# æ¯”è¾ƒè¿‘æœˆå’Œæ¬¡è¿‘æœˆçš„æ–¹å·®è´¡çŒ®
df = pd.read_csv('data/vix_result_510050.SH_20240101_20240131.csv')

# è®¡ç®—æƒé‡å¹³å‡
avg_weight = df['weight'].mean()
print(f"å¹³å‡æ—¶é—´æƒé‡: {avg_weight:.2f}")

# æ–¹å·®è´¡çŒ®
avg_sigma_near = df['sigma_sq_near'].mean()
avg_sigma_next = df['sigma_sq_next'].mean()

print(f"è¿‘æœˆå¹³å‡æ–¹å·®: {avg_sigma_near:.6f}")
print(f"æ¬¡è¿‘æœˆå¹³å‡æ–¹å·®: {avg_sigma_next:.6f}")
```

**è§£è¯»**ï¼š
- **æƒé‡æ¥è¿‘ 1**ï¼šè¿‘æœˆä¸»å¯¼ï¼ŒçŸ­æœŸæ³¢åŠ¨ç‡é¢„æœŸä¸»å¯¼
- **æƒé‡æ¥è¿‘ 0**ï¼šæ¬¡è¿‘æœˆä¸»å¯¼ï¼Œä¸­æœŸæ³¢åŠ¨ç‡é¢„æœŸä¸»å¯¼
- **æƒé‡æ¥è¿‘ 0.5**ï¼šè¿‘æœˆå’Œæ¬¡è¿‘æœˆå½±å“å‡è¡¡

#### 6.2.2 è¿œæœŸä»·æ ¼ï¼ˆFï¼‰

**è¿œæœŸä»·æ ¼ vs ç°è´§ä»·æ ¼**ï¼š
```
F > ç°è´§ä»·æ ¼ â†’ å¸‚åœºé¢„æœŸä¸Šæ¶¨ï¼ˆcontangoï¼‰
F < ç°è´§ä»·æ ¼ â†’ å¸‚åœºé¢„æœŸä¸‹è·Œï¼ˆbackwardationï¼‰
F = ç°è´§ä»·æ ¼ â†’ å¸‚åœºé¢„æœŸæŒå¹³
```

#### 6.2.3 æ— é£é™©åˆ©ç‡å½±å“

```python
# æ¨¡æ‹Ÿåˆ©ç‡å˜åŒ–å¯¹ VIX çš„å½±å“
import numpy as np

base_r = 0.02  # åŸºå‡†åˆ©ç‡ 2%
r_scenarios = [0.01, 0.015, 0.02, 0.025, 0.03]

for r in r_scenarios:
    # é‡æ–°è®¡ç®— VIXï¼ˆä½¿ç”¨ç›¸åŒçš„æœŸæƒæ•°æ®ï¼‰
    vix = calculate_vix_with_r(r, ...)
    print(f"åˆ©ç‡ {r*100:.1f}% â†’ VIX: {vix:.2f}")
```

**ç»“è®º**ï¼šåˆ©ç‡å˜åŒ–å¯¹ VIX çš„å½±å“æå°ï¼ˆ< 0.01 ä¸ªç‚¹ä½ï¼‰

### 6.3 å¼‚å¸¸å€¼è¯Šæ–­

#### 6.3.1 VIX çªå˜

**ç—‡çŠ¶**ï¼šVIX åœ¨æŸå¤©çªç„¶å¤§å¹…æ³¢åŠ¨

**è¯Šæ–­æ­¥éª¤**ï¼š
```python
import pandas as pd

df = pd.read_csv('data/vix_result_510050.SH_20240101_20240131.csv')

# è®¡ç®— VIX å˜åŒ–
df['vix_change'] = df['vix'].diff()

# æ‰¾å‡ºå˜åŒ–è¶…è¿‡ 2 ä¸ªç‚¹ä½çš„æ—¥æœŸ
spikes = df[abs(df['vix_change']) > 2]

print("VIX çªå˜æ—¥æœŸï¼š")
print(spikes[['date', 'vix', 'vix_change']])

# å¯¹æ¯ä¸ªçªå˜æ—¥æœŸï¼ŒæŸ¥çœ‹è¯¦ç»†æ•°æ®
for date in spikes['date']:
    details = pd.read_csv(f'data/vix_details_near_510050.SH_{date}.csv')
    print(f"\n{date} çš„åˆçº¦è´¡çŒ®ï¼š")
    print(details.sort_values('contribution', ascending=False).head(10))
```

#### 6.3.2 VIX æŒç»­é«˜ä½

**ç—‡çŠ¶**ï¼šVIX åœ¨ä¸€æ®µæ—¶é—´å†…æŒç»­é«˜äº 30

**å¯èƒ½åŸå› **ï¼š
- å¸‚åœºææ…Œäº‹ä»¶ï¼ˆé‡‘èå±æœºã€ç–«æƒ…ç­‰ï¼‰
- æœŸæƒå®šä»·å¼‚å¸¸ï¼ˆæ·±åº¦è™šå€¼åˆçº¦ä»·æ ¼è¿‡é«˜ï¼‰
- æ•°æ®é—®é¢˜ï¼ˆæŸç±»åˆçº¦ç¼ºå¤±ï¼‰

**è¯Šæ–­**ï¼š
```python
# æ£€æŸ¥åˆçº¦å®Œæ•´æ€§
details = pd.read_csv('data/vix_details_near_510050.SH_20240101_20240131.csv')

# æŒ‰æ—¥æœŸç»Ÿè®¡åˆçº¦æ•°é‡
contract_count = details.groupby('date').size()
print("æ¯æ—¥åˆçº¦æ•°é‡ï¼š")
print(contract_count)

# æ‰¾å‡ºåˆçº¦æ•°é‡å¼‚å¸¸å°‘çš„æ—¥æœŸ
low_contract_dates = contract_count[contract_count < 50]
print(f"\nåˆçº¦æ•°é‡å¼‚å¸¸å°‘çš„æ—¥æœŸï¼ˆ< 50ï¼‰ï¼š")
print(low_contract_dates)
```

---

## 7. æ”¯æŒçš„æ ‡çš„

### 7.1 ETF æœŸæƒï¼ˆ9 ä¸ªï¼‰

| ä»£ç  | åç§° | å¯¹åº”æŒ‡æ•° | äº¤æ˜“æ‰€ | å¤‡æ³¨ |
|------|------|---------|--------|------|
| `510050.SH` | åå¤ä¸Šè¯ 50ETF | 000016.SH | SSE | æµåŠ¨æ€§æœ€å¥½ |
| `510300.SH` | åæ³°æŸç‘æ²ªæ·± 300ETF | 000300.SH | SSE | ä¸»æµæ ‡çš„ |
| `510500.SH` | å—æ–¹ä¸­è¯ 500ETF | 000905.SH | SSE | ä¸­å°ç›˜ä»£è¡¨ |
| `588000.SH` | åå¤ä¸Šè¯ç§‘åˆ›æ¿ 50ETF | 000688.SH | SSE | ç§‘åˆ›æ¿æ ‡çš„ |
| `588080.SH` | æ˜“æ–¹è¾¾ä¸Šè¯ç§‘åˆ›æ¿ 50ETF | 000688.SH | SSE | ç§‘åˆ›æ¿æ ‡çš„ |
| `159922.SZ` | å˜‰å®ä¸­è¯ 500ETF | 399905.SZ | SZSE | æ·±äº¤æ‰€ç‰ˆæœ¬ |
| `159919.SZ` | å˜‰å®æ²ªæ·± 300ETF | 399300.SZ | SZSE | æ·±äº¤æ‰€ç‰ˆæœ¬ |
| `159901.SZ` | æ˜“æ–¹è¾¾æ·±è¯ 100ETF | 399330.SZ | SZSE | æ·±è¯ 100 |
| `159915.SZ` | æ˜“æ–¹è¾¾åˆ›ä¸šæ¿ETF | 399102.SZ | SZSE | åˆ›ä¸šæ¿æ ‡çš„ |

### 7.2 æŒ‡æ•°æœŸæƒï¼ˆ3 ä¸ªï¼‰

| ä»£ç  | åç§° | å¯¹åº”æŒ‡æ•° | äº¤æ˜“æ‰€ | å¤‡æ³¨ |
|------|------|---------|--------|------|
| `000016.SH` | ä¸Šè¯ 50 æŒ‡æ•° | - | CFFEX | é‡‘èè¡ç”Ÿå“äº¤æ˜“æ‰€ |
| `000300.SH` | æ²ªæ·± 300 æŒ‡æ•° | - | CFFEX | ä¸»æµæŒ‡æ•°æœŸæƒ |
| `000852.SH` | ä¸­è¯ 1000 æŒ‡æ•° | - | CFFEX | ä¸­å°ç›˜æŒ‡æ•° |

### 7.3 æ ‡çš„é€‰æ‹©å»ºè®®

| ä½¿ç”¨åœºæ™¯ | æ¨èæ ‡çš„ | ç†ç”± |
|---------|---------|------|
| **æ•´ä½“å¸‚åœºæƒ…ç»ª** | 510300.SH | è¦†ç›–æ²ªæ·±ä¸¤å¸‚æœ€å…¨é¢ |
| **å¤§ç›˜è“ç­¹** | 510050.SH | æµåŠ¨æ€§æœ€å¥½ï¼Œæˆç†Ÿåº¦é«˜ |
| **ä¸­å°ç›˜** | 510500.SH | ä»£è¡¨ä¸­å°ç›˜è‚¡ç¥¨ |
| **åˆ›ä¸šæ¿** | 159915.SZ | åˆ›ä¸šæ¿å¸‚åœºé£å‘æ ‡ |
| **ç§‘åˆ›æ¿** | 588000.SH | ç§‘åˆ›æ¿å¸‚åœºæ–°å…´åŠ›é‡ |

---

## 8. é«˜çº§åº”ç”¨

### 8.1 VIX å‡å€¼å›å½’ç­–ç•¥

**ç­–ç•¥é€»è¾‘**ï¼šVIX æœ‰å‡å€¼å›å½’ç‰¹æ€§ï¼Œä½ä½ä¹°å…¥ï¼Œé«˜ä½å–å‡º

```python
import pandas as pd
import numpy as np

# åŠ è½½å†å² VIX æ•°æ®
df = pd.read_csv('data/vix_result_510050.SH_20200101_20241231.csv')

# è®¡ç®—ç§»åŠ¨å¹³å‡å’Œæ ‡å‡†å·®
df['vix_ma30'] = df['vix'].rolling(30).mean()
df['vix_std30'] = df['vix'].rolling(30).std()
df['vix_upper'] = df['vix_ma30'] + 2 * df['vix_std30']
df['vix_lower'] = df['vix_ma30'] - 2 * df['vix_std30']

# ç”Ÿæˆä¿¡å·
df['signal'] = 0
df.loc[df['vix'] < df['vix_lower'], 'signal'] = 1  # ä¹°å…¥ä¿¡å·
df.loc[df['vix'] > df['vix_upper'], 'signal'] = -1  # å–å‡ºä¿¡å·

# å›æµ‹ï¼ˆç®€åŒ–ç‰ˆï¼‰
df['return'] = df['vix'].pct_change().shift(-1)
df['strategy_return'] = df['signal'] * df['return']

# è®¡ç®—ç­–ç•¥æ”¶ç›Š
total_return = (1 + df['strategy_return']).prod() - 1
print(f"ç­–ç•¥æ€»æ”¶ç›Š: {total_return:.2%}")
```

### 8.2 VIX åˆ†ä½æ•°ç­–ç•¥

**ç­–ç•¥é€»è¾‘**ï¼šåŸºäº VIX å†å²åˆ†ä½æ•°è¿›è¡Œäº¤æ˜“

```python
import pandas as pd

df = pd.read_csv('data/vix_result_510050.SH_20200101_20241231.csv')

# è®¡ç®—æ»šåŠ¨åˆ†ä½æ•°
df['vix_percentile'] = df['vix'].rolling(252).rank(pct=True)

# ç”Ÿæˆä¿¡å·
df['signal'] = 0
df.loc[df['vix_percentile'] < 0.2, 'signal'] = 1  # æœ€ä½ 20%
df.loc[df['vix_percentile'] > 0.8, 'signal'] = -1  # æœ€é«˜ 20%

# å›æµ‹
# ...ï¼ˆåŒä¸Šï¼‰
```

### 8.3 å¤šæ ‡çš„ VIX å¯¹æ¯”

```python
import pandas as pd
import matplotlib.pyplot as plt

# åŠ è½½å¤šä¸ªæ ‡çš„çš„ VIX æ•°æ®
vix_50 = pd.read_csv('data/vix_result_510050.SH_20240101_20240131.csv')
vix_300 = pd.read_csv('data/vix_result_510300.SH_20240101_20240131.csv')
vix_500 = pd.read_csv('data/vix_result_510500.SH_20240101_20240131.csv')

# åˆå¹¶
merged = pd.merge(
    vix_50[['date', 'vix']],
    vix_300[['date', 'vix']],
    on='date',
    suffixes=('_50', '_300')
)
merged = pd.merge(
    merged,
    vix_500[['date', 'vix']],
    on='date'
)
merged.columns = ['date', 'vix_50', 'vix_300', 'vix_500']

# ç»˜åˆ¶å¯¹æ¯”å›¾
plt.figure(figsize=(12, 6))
plt.plot(merged['date'], merged['vix_50'], label='ä¸Šè¯ 50ETF')
plt.plot(merged['date'], merged['vix_300'], label='æ²ªæ·± 300ETF')
plt.plot(merged['date'], merged['vix_500'], label='ä¸­è¯ 500ETF')
plt.xlabel('Date')
plt.ylabel('VIX')
plt.title('Multi-Underlying VIX Comparison')
plt.legend()
plt.xticks(rotation=45)
plt.show()

# è®¡ç®—ç›¸å…³æ€§
correlation = merged[['vix_50', 'vix_300', 'vix_500']].corr()
print("VIX ç›¸å…³æ€§çŸ©é˜µï¼š")
print(correlation)
```

### 8.4 VIX ä¸æˆäº¤é‡å…³ç³»

```python
import pandas as pd

# åŠ è½½ VIX å’ŒæœŸæƒæˆäº¤é‡æ•°æ®
vix_df = pd.read_csv('data/vix_result_510050.SH_20240101_20240131.csv')
volume_df = pd.read_csv('data/opt_volume_510050.SH_20240101_20240131.csv')

# åˆå¹¶
merged = pd.merge(vix_df, volume_df, on='date')

# è®¡ç®— VIX ä¸æˆäº¤é‡çš„ç›¸å…³æ€§
correlation = merged['vix'].corr(merged['volume'])
print(f"VIX ä¸æˆäº¤é‡çš„ç›¸å…³æ€§: {correlation:.3f}")

# å¯è§†åŒ–
import matplotlib.pyplot as plt

fig, ax1 = plt.subplots(figsize=(12, 6))

ax1.plot(merged['date'], merged['vix'], 'b-', label='VIX')
ax1.set_xlabel('Date')
ax1.set_ylabel('VIX', color='b')
ax1.tick_params(axis='y', labelcolor='b')

ax2 = ax1.twinx()
ax2.plot(merged['date'], merged['volume'], 'r-', label='Volume')
ax2.set_ylabel('Volume', color='r')
ax2.tick_params(axis='y', labelcolor='r')

plt.title('VIX vs Option Volume')
plt.show()
```

---

## 9. å¸¸è§é—®é¢˜

### 9.1 æ•°æ®ç›¸å…³é—®é¢˜

#### Q1: VIX è®¡ç®—ç»“æœä¸ºè´Ÿæ•°æˆ–å¼‚å¸¸é«˜

**å¯èƒ½åŸå› **ï¼š
1. æœŸæƒæ•°æ®ç¼ºå¤±æˆ–ä»·æ ¼å¼‚å¸¸
2. Shibor æ•°æ®ç¼ºå¤±
3. åˆçº¦é€‰æ‹©é€»è¾‘é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
details = pd.read_csv('data/vix_details_near_510050.SH_20240101_20240131.csv')

# æ£€æŸ¥ä»·æ ¼å¼‚å¸¸
abnormal = details[(details['call'] <= 0) | (details['put'] <= 0)]
if len(abnormal) > 0:
    print("å‘ç°å¼‚å¸¸ä»·æ ¼ï¼š")
    print(abnormal.head())

# æ£€æŸ¥ Shibor
shibor_interp = pd.read_csv('data/shibor_interpolated.csv', index_col=0)
print(f"Shibor ç¼ºå¤±å€¼æ•°é‡: {shibor_interp.isnull().sum().sum()}")
```

#### Q2: VIX å€¼æ¯”å®˜æ–¹ iVIX é«˜å¾ˆå¤š

**å¯èƒ½åŸå› **ï¼š
1. ä½¿ç”¨äº†æ”¶ç›˜ä»·è€Œéä¹°å–ä»·ä¸­å€¼
2. æœŸæƒä»·æ ¼åŒ…å«æµåŠ¨æ€§é£é™©æº¢ä»·
3. æœŸé™è®¡ç®—ç²¾åº¦é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨æ›´é«˜è´¨é‡çš„æ•°æ®æºï¼ˆå¦‚é€ç¬”ä¹°å–ä»·æ•°æ®ï¼‰
- è°ƒæ•´æœŸé™è®¡ç®—ç²¾åº¦åˆ°åˆ†é’Ÿçº§åˆ«
- å¯¹å¼‚å¸¸ä»·æ ¼è¿›è¡Œå¹³æ»‘å¤„ç†

#### Q3: VIX åœ¨æŸå¤©çªç„¶è·³å˜

**å¯èƒ½åŸå› **ï¼š
1. æŸä¸ªæœŸæƒåˆçº¦ä»·æ ¼é”™è¯¯
2. æ–°åˆçº¦ä¸Šå¸‚æˆ–æ—§åˆçº¦åˆ°æœŸ
3. å¸‚åœºé‡å¤§äº‹ä»¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# è¯Šæ–­è·³å˜æ—¥æœŸ
date = '20240115'
details = pd.read_csv(f'data/vix_details_near_510050.SH_{date}.csv')

# æŒ‰è´¡çŒ®æ’åº
details_sorted = details.sort_values('contribution', ascending=False)
print("è´¡çŒ®æœ€å¤§çš„ 10 ä¸ªåˆçº¦ï¼š")
print(details_sorted.head(10)[['exercise_price', 'call', 'put', 'contribution']])
```

### 9.2 æ€§èƒ½ç›¸å…³é—®é¢˜

#### Q4: è®¡ç®—é€Ÿåº¦å¤ªæ…¢

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨ç¼“å­˜
2. å¹¶è¡Œè®¡ç®—
3. åˆ†æ‰¹å¤„ç†

```python
# ä½¿ç”¨ joblib ç¼“å­˜
from joblib import Memory
memory = Memory('./cache', verbose=0)

@memory.cache
def calculate_vix_cached(date, underlying):
    return calculate_vix_for_date(date, underlying)

# å¹¶è¡Œè®¡ç®—
from concurrent.futures import ThreadPoolExecutor
with ThreadPoolExecutor(max_workers=4) as executor:
    results = executor.map(calculate_vix_cached, dates)
```

#### Q5: å†…å­˜å ç”¨è¿‡é«˜

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
1. åˆ†æ‰¹åŠ è½½æ•°æ®
2. ä½¿ç”¨åˆ†å—å¤„ç†
3. åŠæ—¶é‡Šæ”¾å†…å­˜

```python
# åˆ†æ‰¹å¤„ç†
batch_size = 30  # æ¯æ‰¹ 30 å¤©
dates = pd.date_range('20240101', '20241231')

for i in range(0, len(dates), batch_size):
    batch_dates = dates[i:i+batch_size]
    # å¤„ç†å½“å‰æ‰¹æ¬¡
    process_batch(batch_dates)
    # é‡Šæ”¾å†…å­˜
    import gc
    gc.collect()
```

### 9.3 ä½¿ç”¨ç›¸å…³é—®é¢˜

#### Q6: å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ ‡çš„ï¼Ÿ

**é€‰æ‹©ä¾æ®**ï¼š
1. **æµåŠ¨æ€§**ï¼šé€‰æ‹©æˆäº¤é‡å’ŒæŒä»“é‡å¤§çš„æ ‡çš„
2. **ä»£è¡¨æ€§**ï¼šé€‰æ‹©èƒ½ä»£è¡¨å¸‚åœºæ•´ä½“èµ°åŠ¿çš„æ ‡çš„
3. **æ•°æ®å®Œæ•´æ€§**ï¼šç¡®ä¿è¯¥æ ‡çš„æœ‰å®Œæ•´çš„å†å²æ•°æ®

**æ¨èä¼˜å…ˆçº§**ï¼š
1. 510050.SHï¼ˆä¸Šè¯ 50ETFï¼‰- æµåŠ¨æ€§æœ€å¥½
2. 510300.SHï¼ˆæ²ªæ·± 300ETFï¼‰- è¦†ç›–æœ€å…¨é¢
3. 510500.SHï¼ˆä¸­è¯ 500ETFï¼‰- ä¸­å°ç›˜ä»£è¡¨

#### Q7: VIX ç»“æœå¦‚ä½•ç”¨äºäº¤æ˜“ï¼Ÿ

**åº”ç”¨åœºæ™¯**ï¼š
1. **é£é™©ç®¡ç†**ï¼šVIX é«˜ä½æ—¶é™ä½ä»“ä½
2. **æ‹©æ—¶ç­–ç•¥**ï¼šVIX ä½ä½æ—¶é€¢ä½ä¹°å…¥
3. **æ³¢åŠ¨ç‡äº¤æ˜“**ï¼šä¹°å…¥æœŸæƒåšå¤šæ³¢åŠ¨ç‡
4. **å¯¹å†²ç­–ç•¥**ï¼šVIX é«˜ä½æ—¶ä¹°å…¥çœ‹è·ŒæœŸæƒå¯¹å†²

**ç¤ºä¾‹ç­–ç•¥**ï¼š
```python
# VIX åˆ†ä½æ•°æ‹©æ—¶ç­–ç•¥
if vix < historical_20th_percentile:
    # VIX ä½ä½ï¼Œé£é™©åå¥½ä¸Šå‡ï¼Œå¯é€‚å½“åŠ ä»“
    action = 'BUY'
elif vix > historical_80th_percentile:
    # VIX é«˜ä½ï¼Œé£é™©åŒæ¶ï¼Œé™ä½ä»“ä½
    action = 'SELL'
else:
    action = 'HOLD'
```

#### Q8: å¦‚ä½•éªŒè¯ VIX è®¡ç®—çš„å‡†ç¡®æ€§ï¼Ÿ

**éªŒè¯æ–¹æ³•**ï¼š
1. ä¸å®˜æ–¹ iVIX å¯¹æ¯”
2. æ£€æŸ¥ä¸­é—´å˜é‡çš„åˆç†æ€§
3. ä½¿ç”¨æµ‹è¯•æ•°æ®é›†éªŒè¯

```python
# ä¸å®˜æ–¹ iVIX å¯¹æ¯”
official_vix = pd.read_csv('official_ivix.csv')
calculated_vix = pd.read_csv('data/vix_result_510050.SH_20240101_20240131.csv')

merged = pd.merge(official_vix, calculated_vix, on='date')

# è®¡ç®—å·®å¼‚
merged['diff'] = merged['vix_official'] - merged['vix_calculated']
merged['diff_pct'] = merged['diff'] / merged['vix_official'] * 100

print(f"å¹³å‡å·®å¼‚: {merged['diff'].mean():.2f}")
print(f"å¹³å‡å·®å¼‚ç™¾åˆ†æ¯”: {merged['diff_pct'].mean():.2f}%")
print(f"æœ€å¤§å·®å¼‚: {merged['diff'].max():.2f}")
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ARCHITECTURE.md](ARCHITECTURE.md) - ç³»ç»Ÿæ¶æ„æ·±åº¦è§£æ
- [README.md](README.md) - ç”¨æˆ·ä½¿ç”¨æŒ‡å—
- [docs/vix_calculation_explanation.md](docs/vix_calculation_explanation.md) - VIX è®¡ç®—è¯¦ç»†è¯´æ˜

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2026-01-06
**ç»´æŠ¤è€…**: Robert
